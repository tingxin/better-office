<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>办公室生存游戏</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html,
        body {
            height: 100%;
            overflow: hidden;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        .game-wrapper {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            width: 100%;
            height: 100%;
            max-height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            text-align: center;
            flex-shrink: 0;
            padding-bottom: 5px;
        }

        .header h1 {
            margin: 0;
            font-size: clamp(1rem, 2vw, 1.4rem);
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 5px 0;
        }

        .stat-item {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: #000000;
            padding: 4px 10px;
            border-radius: 10px;
            font-weight: 600;
            font-size: clamp(10px, 1.2vw, 12px);
            box-shadow: 0 2px 6px rgba(240, 147, 251, 0.3);
        }

        .tip {
            font-size: clamp(9px, 1vw, 11px);
            color: #333;
            margin: 3px 0;
        }

        .game-layout {
            display: flex;
            gap: 10px;
            flex: 1;
            min-height: 0;
            overflow: hidden;
        }

        .main-game-area {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        #gameContainer {
            flex: 1;
            min-height: 0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #gameCanvas {
            display: block;
            cursor: pointer;
            border-radius: 10px;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 5px;
            flex-wrap: wrap;
            padding: 8px 0 0;
            flex-shrink: 0;
        }

        .btn {
            padding: 5px 8px;
            border: none;
            border-radius: 10px;
            font-size: clamp(9px, 1vw, 11px);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.2px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #8b4513;
            box-shadow: 0 3px 10px rgba(252, 182, 159, 0.4);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(252, 182, 159, 0.6);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: #d63384;
            box-shadow: 0 3px 10px rgba(255, 154, 158, 0.4);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 154, 158, 0.6);
        }

        .btn-success {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #198754;
            box-shadow: 0 3px 10px rgba(168, 237, 234, 0.4);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(168, 237, 234, 0.6);
        }

        /* 插件面板样式 - 始终在右侧 */
        .plugin-panel {
            width: 220px;
            min-width: 180px;
            flex-shrink: 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .plugin-panel h3 {
            text-align: center;
            margin-bottom: 8px;
            font-size: clamp(0.85rem, 1.2vw, 1rem);
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            flex-shrink: 0;
        }

        .qr-code-container {
            text-align: center;
            margin: 0 0 10px 0;
            padding: 0;
            flex-shrink: 0;
        }

        .qr-code-image {
            width: 100%;
            max-width: 200px;
            height: auto;
            aspect-ratio: 1;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 2px solid #e9ecef;
            object-fit: contain;
            object-position: center;
            display: block;
            margin: 0 auto;
        }

        .plugin-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1;
            overflow-y: auto;
            padding-right: 3px;
        }

        .plugin-grid::-webkit-scrollbar {
            width: 4px;
        }

        .plugin-grid::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 2px;
        }

        .plugin-grid::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 2px;
        }

        .plugin-card {
            background: #ffffff;
            border-radius: 8px;
            padding: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .plugin-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }

        .plugin-card.active {
            border-color: #28a745;
            background: linear-gradient(135deg, #f8fff9 0%, #e8f5e8 100%);
        }

        .plugin-header {
            display: flex;
            align-items: flex-start;
            gap: 6px;
            margin-bottom: 6px;
        }

        .plugin-icon {
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .plugin-info {
            flex: 1;
            min-width: 0;
        }

        .plugin-info h4 {
            margin: 0 0 2px 0;
            font-size: clamp(0.75rem, 1vw, 0.85rem);
            color: #333;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .plugin-info p {
            margin: 0 0 3px 0;
            color: #666;
            font-size: clamp(0.6rem, 0.9vw, 0.7rem);
            line-height: 1.3;
        }

        .plugin-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2px;
            flex-wrap: wrap;
            gap: 3px;
        }

        .plugin-meta .author {
            font-size: 0.6rem;
            color: #495057;
            background: #f8f9fa;
            padding: 1px 4px;
            border-radius: 4px;
        }

        .plugin-meta .version {
            font-size: 0.55rem;
            color: #6c757d;
            background: #e9ecef;
            padding: 1px 3px;
            border-radius: 4px;
            font-weight: 600;
        }

        .plugin-status {
            padding: 2px 5px;
            border-radius: 8px;
            font-size: 0.6rem;
            font-weight: 600;
            background: #6c757d;
            color: white;
            flex-shrink: 0;
        }

        .plugin-status.active {
            background: #28a745;
        }

        .plugin-controls {
            margin-top: 5px;
        }

        .plugin-controls .btn {
            width: 100%;
            padding: 4px 6px;
            font-size: 0.65rem;
        }

        .plugin-settings {
            margin-top: 5px;
            padding: 6px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .plugin-settings label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: #495057;
            font-size: 0.7rem;
        }

        .plugin-settings select {
            width: 100%;
            padding: 4px 6px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            margin-bottom: 6px;
            font-size: 0.7rem;
        }

        .maintenance-info,
        .wellness-activities {
            margin-top: 6px;
            padding: 5px 8px;
            background: #e9ecef;
            border-radius: 4px;
            font-size: 0.7rem;
        }

        /* 小屏幕响应式 - 插件面板移到下方 */
        @media (max-width: 900px) {
            .game-layout {
                flex-direction: column;
            }

            .plugin-panel {
                width: 100%;
                max-height: 200px;
                flex-direction: column;
            }

            .plugin-grid {
                flex-direction: row;
                flex-wrap: nowrap;
                overflow-x: auto;
                overflow-y: hidden;
                gap: 10px;
                padding-bottom: 5px;
            }

            .plugin-card {
                min-width: 200px;
                flex-shrink: 0;
            }
        }

        /* 成就面板样式 */
        .achievement-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            max-width: 90vw;
            height: 500px;
            max-height: 80vh;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 2px solid #ffc107;
        }

        /* 进展面板样式 */
        .progression-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 700px;
            max-width: 90vw;
            height: 600px;
            max-height: 85vh;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 2px solid #28a745;
        }

        /* 统计面板样式 */
        .statistics-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 800px;
            max-width: 95vw;
            height: 650px;
            max-height: 90vh;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 2px solid #17a2b8;
        }

        .statistics-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
        }

        .statistics-panel-header h3 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .statistics-tabs {
            display: flex;
            background: #e9ecef;
            border-bottom: 1px solid #dee2e6;
        }

        .statistics-tab {
            flex: 1;
            padding: 10px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .statistics-tab.active {
            background: #fff;
            color: #17a2b8;
            border-bottom: 3px solid #17a2b8;
        }

        .statistics-tab:hover {
            background: rgba(23, 162, 184, 0.1);
        }

        .statistics-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        /* 统计卡片样式 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #fff;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #17a2b8;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .stat-card-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .stat-card-icon {
            font-size: 1.5rem;
            margin-right: 10px;
        }

        .stat-card-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #495057;
        }

        .stat-card-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #17a2b8;
            margin-bottom: 5px;
        }

        .stat-card-change {
            font-size: 0.8rem;
            font-weight: 500;
        }

        .stat-card-change.positive {
            color: #28a745;
        }

        .stat-card-change.negative {
            color: #dc3545;
        }

        .stat-card-change.neutral {
            color: #6c757d;
        }

        /* 图表容器样式 */
        .chart-section {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .chart-section h4 {
            margin: 0 0 15px 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 5px;
        }

        .chart-container {
            height: 200px;
            position: relative;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
        }

        /* 趋势指示器样式 */
        .trend-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .trend-indicator {
            background: #fff;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        .trend-icon {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .trend-icon.increasing {
            color: #28a745;
        }

        .trend-icon.decreasing {
            color: #dc3545;
        }

        .trend-icon.stable {
            color: #6c757d;
        }

        .trend-label {
            font-size: 0.8rem;
            color: #6c757d;
            margin-bottom: 3px;
        }

        .trend-value {
            font-size: 0.9rem;
            font-weight: 600;
            color: #333;
        }

        /* 建议和预警样式 */
        .suggestions-section {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .suggestion-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid #ffc107;
        }

        .suggestion-item.high-priority {
            border-left-color: #dc3545;
            background: #fff5f5;
        }

        .suggestion-item.medium-priority {
            border-left-color: #fd7e14;
            background: #fff8f0;
        }

        .suggestion-title {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .suggestion-description {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 8px;
        }

        .suggestion-actions {
            font-size: 0.8rem;
            color: #495057;
        }

        .alert-item {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            color: #721c24;
        }

        .alert-item.high {
            background: #f8d7da;
            border-color: #f5c6cb;
        }

        .alert-item.medium {
            background: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }

        .alert-timestamp {
            font-size: 0.7rem;
            color: #6c757d;
            float: right;
        }

        /* 数据导出样式 */
        .export-section {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .export-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-btn.json {
            background: #17a2b8;
            color: white;
        }

        .export-btn.csv {
            background: #28a745;
            color: white;
        }

        .export-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* 社交分享面板样式 */
        .social-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 800px;
            max-width: 95vw;
            height: 700px;
            max-height: 90vh;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 2px solid #6f42c1;
        }

        .social-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(135deg, #6f42c1 0%, #9c27b0 100%);
            color: white;
        }

        .social-panel-header h3 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .social-tabs {
            display: flex;
            background: #e9ecef;
            border-bottom: 1px solid #dee2e6;
        }

        .social-tab {
            flex: 1;
            padding: 10px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .social-tab.active {
            background: #fff;
            color: #6f42c1;
            border-bottom: 3px solid #6f42c1;
        }

        .social-tab:hover {
            background: rgba(111, 66, 193, 0.1);
        }

        .social-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .social-tab-content {
            display: none;
        }

        .social-tab-content.active {
            display: block;
        }

        /* 分享区域样式 */
        .share-section {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #6f42c1;
        }

        .share-section h4 {
            margin: 0 0 10px 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
        }

        .share-section p {
            margin: 0 0 15px 0;
            color: #6c757d;
            font-size: 0.9rem;
        }

        .achievement-share-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .achievement-share-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .achievement-icon {
            font-size: 1.5rem;
            margin-right: 12px;
            width: 40px;
            text-align: center;
        }

        .achievement-info {
            flex: 1;
        }

        .achievement-info strong {
            display: block;
            font-size: 1rem;
            color: #333;
            margin-bottom: 3px;
        }

        .achievement-info p {
            margin: 0;
            font-size: 0.85rem;
            color: #6c757d;
        }

        .share-history-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .share-type {
            font-size: 1.2rem;
            margin-right: 10px;
            width: 30px;
            text-align: center;
        }

        .share-info {
            flex: 1;
        }

        .share-info strong {
            display: block;
            font-size: 0.9rem;
            color: #333;
        }

        .share-info small {
            color: #6c757d;
            font-size: 0.75rem;
        }

        /* 排行榜样式 */
        .leaderboard-selector {
            margin-bottom: 20px;
        }

        .leaderboard-selector select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 1rem;
            background: white;
        }

        .leaderboard-header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #6f42c1 0%, #9c27b0 100%);
            color: white;
            border-radius: 10px;
        }

        .leaderboard-header h4 {
            margin: 0 0 5px 0;
            font-size: 1.3rem;
        }

        .leaderboard-header p {
            margin: 0;
            opacity: 0.9;
        }

        .leaderboard-entries {
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .leaderboard-entry {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .leaderboard-entry:last-child {
            border-bottom: none;
        }

        .leaderboard-entry:hover {
            background: #f8f9fa;
        }

        .leaderboard-entry.top-rank {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            font-weight: 600;
        }

        .leaderboard-entry .rank {
            font-weight: 700;
            color: #6f42c1;
            width: 40px;
        }

        .leaderboard-entry .player-name {
            flex: 1;
            margin-left: 10px;
        }

        .leaderboard-entry .score {
            font-weight: 600;
            color: #28a745;
            margin-right: 15px;
        }

        .leaderboard-entry .date {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .leaderboard-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        /* 挑战样式 */
        .challenges-section,
        .special-events-section {
            margin-bottom: 30px;
        }

        .challenges-section h4,
        .special-events-section h4 {
            margin: 0 0 15px 0;
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 5px;
        }

        .challenge-item,
        .event-item {
            background: #fff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #6f42c1;
            transition: all 0.3s ease;
        }

        .challenge-item:hover,
        .event-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .challenge-item.completed,
        .event-item.completed {
            border-left-color: #28a745;
            background: linear-gradient(135deg, #f8fff9 0%, #e8f5e8 100%);
        }

        .event-item.hard {
            border-left-color: #fd7e14;
        }

        .event-item.extreme {
            border-left-color: #dc3545;
        }

        .challenge-header,
        .event-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .challenge-icon,
        .event-icon {
            font-size: 1.5rem;
            margin-right: 12px;
            width: 40px;
            text-align: center;
        }

        .challenge-info,
        .event-info {
            flex: 1;
        }

        .challenge-info strong,
        .event-info strong {
            display: block;
            font-size: 1rem;
            color: #333;
            margin-bottom: 3px;
        }

        .challenge-info p,
        .event-info p {
            margin: 0 0 5px 0;
            font-size: 0.85rem;
            color: #6c757d;
        }

        .challenge-type {
            background: #6f42c1;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .event-difficulty {
            background: #fd7e14;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .challenge-progress,
        .event-progress {
            margin: 10px 0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #6f42c1 0%, #9c27b0 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .challenge-item.completed .progress-fill,
        .event-item.completed .progress-fill {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .progress-text {
            font-size: 0.8rem;
            color: #6c757d;
            font-weight: 600;
        }

        .challenge-actions,
        .event-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }

        .time-remaining {
            font-size: 0.8rem;
            color: #fd7e14;
            font-weight: 600;
        }

        /* 分享预览模态框样式 */
        .share-preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .share-preview-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .share-preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .share-preview-header h3 {
            margin: 0;
            color: #333;
        }

        .share-preview-body {
            margin-bottom: 20px;
        }

        .achievement-share-preview {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .achievement-icon-large {
            font-size: 3rem;
            display: block;
            margin-bottom: 10px;
        }

        .achievement-share-preview h4 {
            margin: 0 0 10px 0;
            color: #856404;
        }

        .achievement-share-preview h3 {
            margin: 0 0 10px 0;
            color: #333;
        }

        .achievement-share-preview p {
            margin: 0 0 15px 0;
            color: #6c757d;
        }

        .player-stats {
            padding-top: 10px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            font-size: 0.9rem;
        }

        .share-preview-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .share-preview-actions .btn {
            flex: 1;
            min-width: 120px;
        }

        .no-data {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 20px;
        }

        .progression-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .progression-panel-header h3 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .progression-stats {
            display: flex;
            justify-content: space-around;
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .progression-stat-item {
            text-align: center;
        }

        .progression-tabs {
            display: flex;
            background: #e9ecef;
            border-bottom: 1px solid #dee2e6;
        }

        .progression-tab {
            flex: 1;
            padding: 10px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .progression-tab.active {
            background: #fff;
            color: #28a745;
            border-bottom: 3px solid #28a745;
        }

        .progression-tab:hover {
            background: rgba(40, 167, 69, 0.1);
        }

        .progression-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        /* 等级进度条样式 */
        .level-progress-section {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #28a745;
        }

        .level-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .current-level {
            font-size: 2rem;
            font-weight: 700;
            color: #28a745;
        }

        .level-details {
            text-align: right;
        }

        .experience-info {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .next-level-info {
            font-size: 0.8rem;
            color: #495057;
        }

        .level-progress-bar {
            width: 100%;
            height: 12px;
            background: #e9ecef;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .level-progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border-radius: 6px;
            transition: width 0.5s ease;
            position: relative;
        }

        .level-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progressShine 2s infinite;
        }

        @keyframes progressShine {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .level-progress-text {
            text-align: center;
            font-size: 0.85rem;
            color: #495057;
            font-weight: 600;
        }

        /* 解锁预览样式 */
        .unlock-preview-section {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .unlock-preview-section h4 {
            margin: 0 0 15px 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 5px;
        }

        .unlock-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .unlock-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            transition: all 0.3s ease;
        }

        .unlock-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .unlock-item.locked {
            border-left-color: #6c757d;
            opacity: 0.7;
        }

        .unlock-icon {
            font-size: 1.5rem;
            margin-right: 12px;
            width: 40px;
            text-align: center;
        }

        .unlock-info {
            flex: 1;
        }

        .unlock-name {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 3px;
        }

        .unlock-description {
            font-size: 0.85rem;
            color: #6c757d;
            line-height: 1.3;
        }

        .unlock-level {
            font-size: 0.8rem;
            color: #28a745;
            font-weight: 600;
            background: rgba(40, 167, 69, 0.1);
            padding: 2px 8px;
            border-radius: 12px;
            margin-left: 10px;
        }

        .unlock-level.locked {
            color: #6c757d;
            background: rgba(108, 117, 125, 0.1);
        }

        /* 里程碑样式 */
        .milestone-section {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .milestone-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 4px solid #dee2e6;
            transition: all 0.3s ease;
        }

        .milestone-item.completed {
            border-left-color: #28a745;
            background: linear-gradient(135deg, #f8fff9 0%, #e8f5e8 100%);
        }

        .milestone-item.in-progress {
            border-left-color: #ffc107;
            background: linear-gradient(135deg, #fffbf0 0%, #fff3cd 100%);
        }

        .milestone-icon {
            font-size: 1.8rem;
            margin-right: 15px;
            width: 50px;
            text-align: center;
        }

        .milestone-icon.completed {
            filter: none;
        }

        .milestone-icon:not(.completed) {
            filter: grayscale(100%) opacity(0.5);
        }

        .milestone-info {
            flex: 1;
        }

        .milestone-name {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .milestone-description {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 8px;
        }

        .milestone-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .milestone-progress-bar {
            flex: 1;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }

        .milestone-progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .milestone-progress-text {
            font-size: 0.8rem;
            color: #6c757d;
            min-width: 40px;
        }

        .milestone-reward {
            font-size: 0.8rem;
            color: #28a745;
            font-weight: 600;
            margin-top: 5px;
        }

        /* 等级提升庆祝动画 */
        .level-up-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .level-up-animation {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: levelUpPop 0.8s ease-out;
            max-width: 500px;
            color: white;
        }

        .level-up-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: levelUpBounce 1.5s ease-in-out infinite;
        }

        .level-up-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .level-up-level {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .level-up-rewards {
            font-size: 1.1rem;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .level-up-unlocks {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .level-up-continue {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .level-up-continue:hover {
            background: white;
            color: #28a745;
        }

        @keyframes levelUpPop {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes levelUpBounce {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }

            25% {
                transform: translateY(-10px) rotate(-5deg);
            }

            75% {
                transform: translateY(-5px) rotate(5deg);
            }
        }

        .achievement-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(135deg, #ffc107 0%, #ff8f00 100%);
            color: #000;
        }

        .achievement-panel-header h3 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #000;
            padding: 5px;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .achievement-stats {
            display: flex;
            justify-content: space-around;
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .achievement-stat-item {
            text-align: center;
        }

        .stat-label {
            display: block;
            font-size: 0.8rem;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .achievement-tabs {
            display: flex;
            background: #e9ecef;
            border-bottom: 1px solid #dee2e6;
        }

        .achievement-tab {
            flex: 1;
            padding: 10px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .achievement-tab.active {
            background: #fff;
            color: #ffc107;
            border-bottom: 3px solid #ffc107;
        }

        .achievement-tab:hover {
            background: rgba(255, 193, 7, 0.1);
        }

        .achievement-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .achievement-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .achievement-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #dee2e6;
            transition: all 0.3s ease;
        }

        .achievement-item.unlocked {
            border-left-color: #28a745;
            background: linear-gradient(135deg, #f8fff9 0%, #e8f5e8 100%);
        }

        .achievement-item.unlocked .achievement-icon {
            filter: none;
        }

        .achievement-item:not(.unlocked) .achievement-icon {
            filter: grayscale(100%) opacity(0.5);
        }

        .achievement-icon {
            font-size: 2rem;
            margin-right: 15px;
            width: 50px;
            text-align: center;
        }

        .achievement-info {
            flex: 1;
        }

        .achievement-name {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .achievement-description {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 8px;
        }

        .achievement-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar {
            flex: 1;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 0.8rem;
            color: #6c757d;
            min-width: 40px;
        }

        .achievement-reward {
            font-size: 0.8rem;
            color: #ffc107;
            font-weight: 600;
            margin-top: 5px;
        }

        .achievement-unlock-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .achievement-unlock-animation {
            background: linear-gradient(135deg, #ffc107 0%, #ff8f00 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: achievementPop 0.6s ease-out;
            max-width: 400px;
        }

        .achievement-unlock-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: achievementBounce 1s ease-in-out infinite;
        }

        .achievement-unlock-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #000;
            margin-bottom: 10px;
        }

        .achievement-unlock-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #000;
            margin-bottom: 10px;
        }

        .achievement-unlock-description {
            font-size: 1rem;
            color: #333;
            margin-bottom: 15px;
        }

        .achievement-unlock-reward {
            font-size: 0.9rem;
            color: #000;
            font-weight: 600;
        }

        @keyframes achievementPop {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes achievementBounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        /* 事件对话框样式 */
        .event-dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1500;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        .event-dialog {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            width: 500px;
            max-width: 90vw;
            max-height: 80vh;
            overflow: hidden;
            animation: eventDialogPop 0.4s ease-out;
        }

        .event-dialog-header {
            display: flex;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .event-type-indicator {
            font-size: 2rem;
            margin-right: 15px;
            width: 50px;
            text-align: center;
        }

        .event-header-info {
            flex: 1;
        }

        .event-header-info h3 {
            margin: 0 0 5px 0;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .event-type-text {
            font-size: 0.9rem;
            opacity: 0.9;
            font-weight: 500;
        }

        .event-close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        .event-close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .event-dialog-content {
            padding: 25px;
        }

        .event-description {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #333;
            margin-bottom: 25px;
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .event-choices {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .event-choice-btn {
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .event-choice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .event-choice-btn.primary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .event-choice-btn.secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
        }

        .event-choice-btn.warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: #000;
        }

        .event-choice-btn.danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .event-choice-text {
            display: block;
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .event-choice-cost {
            display: block;
            font-size: 0.85rem;
            opacity: 0.8;
            font-weight: 400;
        }

        .event-choice-consequences {
            display: block;
            font-size: 0.8rem;
            opacity: 0.7;
            font-style: italic;
            margin-top: 3px;
        }

        /* 事件结果对话框样式 */
        .event-result-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1600;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        .event-result-dialog {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            width: 400px;
            max-width: 90vw;
            animation: eventResultPop 0.4s ease-out;
        }

        .event-result-header {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border-radius: 15px 15px 0 0;
        }

        .event-result-icon {
            font-size: 2.5rem;
            margin-right: 10px;
        }

        .event-result-header h3 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .event-result-content {
            padding: 25px;
            text-align: center;
        }

        .event-result-description {
            font-size: 1rem;
            color: #333;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .event-result-consequences {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .consequence-item {
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .consequence-item.positive {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
        }

        .consequence-item.negative {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
        }

        .consequence-item.neutral {
            background: linear-gradient(135deg, #e2e3e5 0%, #d6d8db 100%);
            color: #383d41;
        }

        .event-result-ok-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .event-result-ok-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        /* 员工详情面板样式 */
        .employee-details-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 500px;
            max-width: 90vw;
            height: 600px;
            max-height: 85vh;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            z-index: 1200;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 2px solid #667eea;
        }

        .employee-details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .employee-details-header h3 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .employee-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 15px;
        }

        .employee-basic-info {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .employee-name-status {
            flex: 1;
        }

        .employee-name {
            font-size: 1.2rem;
            font-weight: 700;
            margin: 0;
        }

        .employee-status {
            font-size: 0.9rem;
            opacity: 0.9;
            margin: 2px 0 0 0;
        }

        .employee-details-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .employee-section {
            margin-bottom: 25px;
        }

        .employee-section h4 {
            margin: 0 0 15px 0;
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 5px;
        }

        .personality-traits {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .trait-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            border-left: 4px solid #667eea;
        }

        .trait-name {
            font-size: 0.85rem;
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
        }

        .trait-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 3px;
        }

        .trait-description {
            font-size: 0.75rem;
            color: #6c757d;
            line-height: 1.3;
        }

        .trait-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin: 5px 0;
        }

        .trait-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .skills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
        }

        .skill-item {
            background: #fff;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .skill-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .skill-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .skill-name {
            font-size: 0.8rem;
            font-weight: 600;
            color: #495057;
            margin-bottom: 3px;
        }

        .skill-value {
            font-size: 1rem;
            font-weight: 700;
            color: #333;
        }

        .status-indicators {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .status-item {
            background: #fff;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .status-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .status-name {
            font-size: 0.8rem;
            font-weight: 600;
            color: #495057;
            margin-bottom: 3px;
        }

        .status-value {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .status-bar {
            width: 100%;
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            overflow: hidden;
            margin: 5px 0 0 0;
        }

        .status-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        .personality-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .personality-tag {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .relationships-section {
            margin-top: 15px;
        }

        .relationship-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .relationship-name {
            font-size: 0.85rem;
            font-weight: 500;
            color: #495057;
        }

        .relationship-value {
            font-size: 0.8rem;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 10px;
        }

        .relationship-good {
            background: #d4edda;
            color: #155724;
        }

        .relationship-neutral {
            background: #e2e3e5;
            color: #383d41;
        }

        .relationship-poor {
            background: #f8d7da;
            color: #721c24;
        }

        /* 事件通知样式 */
        .event-notifications {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1400;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .event-notification {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-left: 4px solid #667eea;
            animation: slideInRight 0.4s ease-out;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .event-notification:hover {
            transform: translateX(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
        }

        .event-notification.emergency {
            border-left-color: #dc3545;
            background: linear-gradient(135deg, rgba(248, 215, 218, 0.9) 0%, rgba(245, 198, 203, 0.9) 100%);
        }

        .event-notification.opportunity {
            border-left-color: #28a745;
            background: linear-gradient(135deg, rgba(212, 237, 218, 0.9) 0%, rgba(195, 230, 203, 0.9) 100%);
        }

        .event-notification.special {
            border-left-color: #ffc107;
            background: linear-gradient(135deg, rgba(255, 243, 205, 0.9) 0%, rgba(254, 230, 138, 0.9) 100%);
        }

        .event-notification-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .event-notification-icon {
            font-size: 1.5rem;
            margin-right: 10px;
        }

        .event-notification-title {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            flex: 1;
        }

        .event-notification-type {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.1);
            color: #666;
            font-weight: 500;
        }

        .event-notification-description {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .event-notification-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: #888;
        }

        .event-notification-time {
            font-style: italic;
        }

        .event-notification-action {
            color: #667eea;
            font-weight: 600;
        }

        /* 动画效果 */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes eventDialogPop {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes eventResultPop {
            0% {
                transform: scale(0.9) translateY(-20px);
                opacity: 0;
            }

            100% {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* 超小屏幕 */
        @media (max-width: 600px) {
            body {
                padding: 5px;
            }

            .game-wrapper {
                padding: 5px;
                border-radius: 8px;
            }

            .controls {
                gap: 3px;
            }

            .btn {
                padding: 4px 6px;
                font-size: 9px;
            }

            .plugin-panel {
                max-height: 180px;
            }

            .plugin-card {
                min-width: 180px;
            }

            .achievement-panel {
                width: 95vw;
                height: 85vh;
            }

            .achievement-unlock-animation {
                padding: 20px;
                max-width: 300px;
            }
        }
    </style>
</head>

<body>
    <div class="game-wrapper">
        <div class="header">
            <h1>🏢 办公室生存游戏</h1>
            <div class="stats">
                <div class="stat-item">
                    👥 员工: <span id="employeeCount">0</span>
                </div>
                <div class="stat-item">
                    ⏰ 时间: <span id="gameTime">00:00</span>
                </div>
                <div class="stat-item" id="money-stat" style="display: none;">
                    💰 资金: <span id="moneyAmount">50000</span>
                </div>
                <div class="stat-item" id="satisfaction-stat" style="display: none;">
                    😊 满意度: <span id="satisfactionLevel">50</span>%
                </div>
                <div class="stat-item" id="reputation-stat" style="display: none;">
                    ⭐ 声望: <span id="reputationLevel">50</span>
                </div>
                <div class="stat-item" id="productivity-stat" style="display: none;">
                    📈 生产力: <span id="productivityLevel">50</span>%
                </div>
                <div class="stat-item" id="achievement-stat" style="display: none;">
                    🏆 成就: <span id="achievementCount">0</span>/<span id="totalAchievements">0</span>
                </div>
                <div class="stat-item" id="level-stat" style="display: none;">
                    🏢 等级: <span id="companyLevel">1</span>
                </div>
                <div class="stat-item" id="experience-stat" style="display: none;">
                    ⭐ 经验: <span id="experiencePoints">0</span>/<span id="experienceToNext">1000</span>
                </div>
            </div>
            <p class="tip" style="color: #000000 !important;">💡 点击员工查看姓名和活动状态！观察他们的日常工作生活</p>
        </div>

        <div class="game-layout">
            <div class="main-game-area">
                <div id="gameContainer">
                    <canvas id="gameCanvas" width="900" height="560"></canvas>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" onclick="addEmployee()">➕ 添加员工</button>
                    <button class="btn btn-secondary" onclick="removeEmployee()">➖ 移除员工</button>
                    <button class="btn btn-success" onclick="togglePause()">⏸️ 暂停/继续</button>
                    <button class="btn btn-danger" onclick="resetGame()">🔄 重置游戏</button>
                    <button class="btn btn-primary" onclick="debugPlugins()" style="background: #17a2b8;">🔧
                        调试插件</button>
                    <button class="btn btn-success" onclick="testEnhancedFeatures()" style="background: #6f42c1;">🎮
                        测试增强功能</button>
                    <button class="btn btn-primary" onclick="toggleAchievementPanel()"
                        style="background: #ffc107; color: #000;">🏆
                        成就面板</button>
                    <button class="btn btn-primary" onclick="toggleProgressionPanel()"
                        style="background: #28a745; color: #fff;">📈
                        进展面板</button>
                    <button class="btn btn-primary" onclick="toggleStatisticsPanel()"
                        style="background: #17a2b8; color: #fff;">📊
                        统计面板</button>
                    <button class="btn btn-primary" onclick="toggleSocialPanel()"
                        style="background: #6f42c1; color: #fff;">🌟
                        社交分享</button>
                </div>
            </div>

            <!-- 插件管理面板 -->
            <div class="plugin-panel">
                <h3>🔌 办公室改善插件</h3>
                <!-- 二维码图片 -->
                <div class="qr-code-container">
                    <img src="assets/qr.jpg" alt="二维码" class="qr-code-image" />
                </div>
                <div class="plugin-grid"></div>""
                <!-- 空调插件 -->
                <div class="plugin-card" id="ac-plugin-card">
                    <div class="plugin-header">
                        <span class="plugin-icon">🌡️</span>
                        <div class="plugin-info">
                            <h4>智能空调系统</h4>
                            <p>自动调节温度，减少员工抱怨</p>
                            <div class="plugin-meta">
                                <span class="author">👤 Kiro开发团队</span>
                                <span class="version">v1.2.0</span>
                            </div>
                        </div>
                        <div class="plugin-status" id="ac-status">未激活</div>
                    </div>
                    <div class="plugin-controls">
                        <div class="plugin-cost" style="font-size: 0.6rem; color: #6c757d; margin-bottom: 3px;">
                            💰 5000 | ⭐ 5
                        </div>
                        <button class="btn btn-primary" onclick="togglePlugin('智能空调系统', 'ac')"
                            id="ac-toggle">激活插件</button>
                        <div class="plugin-settings" id="ac-settings" style="display: none;">
                            <label>温度级别:</label>
                            <select onchange="adjustTemperature(this.value)" id="temp-level">
                                <option value="1">正常</option>
                                <option value="2">舒适</option>
                                <option value="3">完美</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 打印机插件 -->
                <div class="plugin-card" id="printer-plugin-card">
                    <div class="plugin-header">
                        <span class="plugin-icon">🖨️</span>
                        <div class="plugin-info">
                            <h4>打印机维护系统</h4>
                            <p>定期维护，减少故障和排队</p>
                            <div class="plugin-meta">
                                <span class="author">👤 办公设备专家</span>
                                <span class="version">v2.1.0</span>
                            </div>
                        </div>
                        <div class="plugin-status" id="printer-status">未激活</div>
                    </div>
                    <div class="plugin-controls">
                        <div class="plugin-cost" style="font-size: 0.6rem; color: #6c757d; margin-bottom: 3px;">
                            💰 3000 | ⭐ 3
                        </div>
                        <button class="btn btn-primary" onclick="togglePlugin('打印机维护系统', 'printer')"
                            id="printer-toggle">激活插件</button>
                        <div class="plugin-settings" id="printer-settings" style="display: none;">
                            <button class="btn btn-secondary" onclick="emergencyRepair()">🚨 紧急维修</button>
                            <div class="maintenance-info">
                                <span>备用打印机: <span id="backup-count">0</span></span>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>
    </div>

    <!-- 成就面板 -->
    <div id="achievementPanel" class="achievement-panel" style="display: none;">
        <div class="achievement-panel-header">
            <h3>🏆 成就系统</h3>
            <button class="close-btn" onclick="toggleAchievementPanel()">✕</button>
        </div>
        <div class="achievement-stats">
            <div class="achievement-stat-item">
                <span class="stat-label">完成度:</span>
                <span id="achievementCompletionRate">0%</span>
            </div>
            <div class="achievement-stat-item">
                <span class="stat-label">已解锁:</span>
                <span id="achievementUnlocked">0</span>/<span id="achievementTotal">0</span>
            </div>
        </div>
        <div class="achievement-tabs">
            <button class="achievement-tab active" onclick="showAchievementTab('all')">全部</button>
            <button class="achievement-tab" onclick="showAchievementTab('unlocked')">已解锁</button>
            <button class="achievement-tab" onclick="showAchievementTab('locked')">未解锁</button>
            <button class="achievement-tab" onclick="showAchievementTab('recent')">最近</button>
        </div>
        <div class="achievement-content">
            <div id="achievementList" class="achievement-list">
                <!-- 成就项目将在这里动态生成 -->
            </div>
        </div>
    </div>

    <!-- 进展面板 -->
    <div id="progressionPanel" class="progression-panel" style="display: none;">
        <div class="progression-panel-header">
            <h3>📈 公司进展系统</h3>
            <button class="close-btn" onclick="toggleProgressionPanel()">✕</button>
        </div>
        <div class="progression-stats">
            <div class="progression-stat-item">
                <span class="stat-label">当前等级:</span>
                <span id="progressionCurrentLevel">1</span>
            </div>
            <div class="progression-stat-item">
                <span class="stat-label">员工容量:</span>
                <span id="progressionEmployeeCapacity">20</span>
            </div>
            <div class="progression-stat-item">
                <span class="stat-label">已解锁功能:</span>
                <span id="progressionUnlockedFeatures">1</span>
            </div>
            <div class="progression-stat-item">
                <span class="stat-label">楼层数:</span>
                <span id="progressionFloors">1</span>
            </div>
        </div>
        <div class="progression-tabs">
            <button class="progression-tab active" onclick="showProgressionTab('overview')">概览</button>
            <button class="progression-tab" onclick="showProgressionTab('unlocks')">解锁预览</button>
            <button class="progression-tab" onclick="showProgressionTab('milestones')">里程碑</button>
            <button class="progression-tab" onclick="showProgressionTab('floors')">楼层管理</button>
        </div>
        <div class="progression-content">
            <div id="progressionOverview" class="progression-tab-content">
                <!-- 等级进度部分 -->
                <div class="level-progress-section">
                    <div class="level-info">
                        <div>
                            <div class="current-level" id="currentLevelDisplay">1</div>
                            <div style="font-size: 0.9rem; color: #6c757d;">公司等级</div>
                        </div>
                        <div class="level-details">
                            <div class="experience-info">
                                经验: <span id="currentExperience">0</span> / <span id="experienceRequired">1000</span>
                            </div>
                            <div class="next-level-info">
                                距离下一级: <span id="experienceRemaining">1000</span> 经验
                            </div>
                        </div>
                    </div>
                    <div class="level-progress-bar">
                        <div class="level-progress-fill" id="levelProgressFill" style="width: 0%"></div>
                    </div>
                    <div class="level-progress-text" id="levelProgressText">0%</div>
                </div>

                <!-- 即将解锁内容 -->
                <div class="unlock-preview-section">
                    <h4>🔓 下一级解锁内容</h4>
                    <div class="unlock-items" id="nextLevelUnlocks">
                        <!-- 解锁项目将在这里动态生成 -->
                    </div>
                </div>
            </div>

            <div id="progressionUnlocks" class="progression-tab-content" style="display: none;">
                <div class="unlock-preview-section">
                    <h4>🔮 未来解锁预览</h4>
                    <div class="unlock-items" id="futureUnlocks">
                        <!-- 未来解锁项目将在这里动态生成 -->
                    </div>
                </div>
            </div>

            <div id="progressionMilestones" class="progression-tab-content" style="display: none;">
                <div class="milestone-section">
                    <h4>🏁 里程碑进度</h4>
                    <div id="milestoneList">
                        <!-- 里程碑项目将在这里动态生成 -->
                    </div>
                </div>
            </div>

            <div id="progressionFloors" class="progression-tab-content" style="display: none;">
                <div class="milestone-section">
                    <h4>🏢 楼层管理</h4>
                    <div id="floorList">
                        <!-- 楼层信息将在这里动态生成 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 统计面板 -->
    <div id="statisticsPanel" class="statistics-panel" style="display: none;">
        <div class="statistics-panel-header">
            <h3>📊 数据统计与分析</h3>
            <button class="close-btn" onclick="toggleStatisticsPanel()">✕</button>
        </div>
        <div class="statistics-tabs">
            <button class="statistics-tab active" onclick="showStatisticsTab('overview')">概览</button>
            <button class="statistics-tab" onclick="showStatisticsTab('trends')">趋势分析</button>
            <button class="statistics-tab" onclick="showStatisticsTab('performance')">性能指标</button>
            <button class="statistics-tab" onclick="showStatisticsTab('suggestions')">智能建议</button>
            <button class="statistics-tab" onclick="showStatisticsTab('export')">数据导出</button>
        </div>
        <div class="statistics-content">
            <!-- 概览标签页 -->
            <div id="statisticsOverview" class="statistics-tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-icon">💰</div>
                            <div class="stat-card-title">当前资金</div>
                        </div>
                        <div class="stat-card-value" id="statCurrentMoney">50,000</div>
                        <div class="stat-card-change neutral" id="statMoneyChange">无变化</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-icon">👥</div>
                            <div class="stat-card-title">员工数量</div>
                        </div>
                        <div class="stat-card-value" id="statEmployeeCount">0</div>
                        <div class="stat-card-change neutral" id="statEmployeeChange">无变化</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-icon">😊</div>
                            <div class="stat-card-title">员工满意度</div>
                        </div>
                        <div class="stat-card-value" id="statSatisfaction">50%</div>
                        <div class="stat-card-change neutral" id="statSatisfactionChange">无变化</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-icon">📈</div>
                            <div class="stat-card-title">生产力</div>
                        </div>
                        <div class="stat-card-value" id="statProductivity">50%</div>
                        <div class="stat-card-change neutral" id="statProductivityChange">无变化</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-icon">⭐</div>
                            <div class="stat-card-title">公司声望</div>
                        </div>
                        <div class="stat-card-value" id="statReputation">50</div>
                        <div class="stat-card-change neutral" id="statReputationChange">无变化</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-icon">💸</div>
                            <div class="stat-card-title">每日收入</div>
                        </div>
                        <div class="stat-card-value" id="statDailyIncome">1,000</div>
                        <div class="stat-card-change neutral" id="statIncomeChange">无变化</div>
                    </div>
                </div>

                <div class="chart-section">
                    <h4>📊 资源历史趋势</h4>
                    <div class="chart-container" id="resourceChart">
                        <div>图表功能开发中...</div>
                    </div>
                </div>

                <div class="chart-section">
                    <h4>👥 员工数量变化</h4>
                    <div class="chart-container" id="employeeChart">
                        <div>图表功能开发中...</div>
                    </div>
                </div>
            </div>

            <!-- 趋势分析标签页 -->
            <div id="statisticsTrends" class="statistics-tab-content" style="display: none;">
                <div class="trend-indicators">
                    <div class="trend-indicator">
                        <div class="trend-icon stable" id="trendSatisfactionIcon">➡️</div>
                        <div class="trend-label">员工满意度</div>
                        <div class="trend-value" id="trendSatisfactionValue">稳定</div>
                    </div>
                    <div class="trend-indicator">
                        <div class="trend-icon stable" id="trendProductivityIcon">➡️</div>
                        <div class="trend-label">生产力</div>
                        <div class="trend-value" id="trendProductivityValue">稳定</div>
                    </div>
                    <div class="trend-indicator">
                        <div class="trend-icon stable" id="trendReputationIcon">➡️</div>
                        <div class="trend-label">公司声望</div>
                        <div class="trend-value" id="trendReputationValue">稳定</div>
                    </div>
                    <div class="trend-indicator">
                        <div class="trend-icon stable" id="trendMoneyIcon">➡️</div>
                        <div class="trend-label">资金状况</div>
                        <div class="trend-value" id="trendMoneyValue">稳定</div>
                    </div>
                    <div class="trend-indicator">
                        <div class="trend-icon stable" id="trendEmployeesIcon">➡️</div>
                        <div class="trend-label">员工规模</div>
                        <div class="trend-value" id="trendEmployeesValue">稳定</div>
                    </div>
                </div>

                <div class="chart-section">
                    <h4>🔮 趋势预测</h4>
                    <div class="chart-container" id="predictionChart">
                        <div>基于当前趋势的未来预测图表</div>
                    </div>
                </div>

                <div class="suggestions-section">
                    <h4>📈 趋势分析报告</h4>
                    <div id="trendAnalysisReport">
                        <p>系统正在分析数据趋势，请稍候...</p>
                    </div>
                </div>
            </div>

            <!-- 性能指标标签页 -->
            <div id="statisticsPerformance" class="statistics-tab-content" style="display: none;">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-icon">⚡</div>
                            <div class="stat-card-title">运营效率</div>
                        </div>
                        <div class="stat-card-value" id="statEfficiency">0%</div>
                        <div class="stat-card-change neutral" id="statEfficiencyChange">计算中...</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-icon">📊</div>
                            <div class="stat-card-title">增长率</div>
                        </div>
                        <div class="stat-card-value" id="statGrowthRate">0%</div>
                        <div class="stat-card-change neutral" id="statGrowthRateChange">计算中...</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-icon">🎯</div>
                            <div class="stat-card-title">员工留存率</div>
                        </div>
                        <div class="stat-card-value" id="statRetentionRate">100%</div>
                        <div class="stat-card-change neutral" id="statRetentionRateChange">计算中...</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-icon">💹</div>
                            <div class="stat-card-title">盈利能力</div>
                        </div>
                        <div class="stat-card-value" id="statProfitability">0%</div>
                        <div class="stat-card-change neutral" id="statProfitabilityChange">计算中...</div>
                    </div>
                </div>

                <div class="chart-section">
                    <h4>📊 性能指标历史</h4>
                    <div class="chart-container" id="performanceChart">
                        <div>性能指标历史图表</div>
                    </div>
                </div>

                <div class="suggestions-section">
                    <h4>🎯 关键绩效指标 (KPI)</h4>
                    <div id="kpiSummary">
                        <p>正在计算关键绩效指标...</p>
                    </div>
                </div>
            </div>

            <!-- 智能建议标签页 -->
            <div id="statisticsSuggestions" class="statistics-tab-content" style="display: none;">
                <div class="suggestions-section">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h4>💡 智能建议</h4>
                        <button id="autoSuggestionsToggle" class="export-btn" onclick="toggleAutoSuggestions()"
                            style="background: #28a745; color: white; font-size: 0.85rem;">
                            启用自动建议
                        </button>
                    </div>
                    <div id="suggestionsList">
                        <p>系统正在分析当前状况，生成改进建议...</p>
                    </div>
                </div>

                <div class="suggestions-section">
                    <h4>⚠️ 系统预警</h4>
                    <div id="alertsList">
                        <p>暂无预警信息</p>
                    </div>
                </div>

                <div class="suggestions-section">
                    <h4>📋 建议执行历史</h4>
                    <div id="suggestionExecutionHistory">
                        <p>暂无建议执行记录</p>
                    </div>
                </div>

                <div class="suggestions-section">
                    <h4>📊 建议执行统计</h4>
                    <div id="suggestionExecutionStats">
                        <p>暂无统计数据</p>
                    </div>
                </div>
            </div>

            <!-- 数据导出标签页 -->
            <div id="statisticsExport" class="statistics-tab-content" style="display: none;">
                <div class="export-section">
                    <h4>📤 数据导出</h4>
                    <p>导出游戏统计数据用于进一步分析</p>

                    <div class="export-buttons">
                        <button class="export-btn json" onclick="exportStatisticsData('json')">
                            📄 导出 JSON 格式
                        </button>
                        <button class="export-btn csv" onclick="exportStatisticsData('csv')">
                            📊 导出 CSV 格式
                        </button>
                    </div>

                    <div style="margin-top: 20px;">
                        <h5>📊 数据收集状态</h5>
                        <div id="dataCollectionStatus">
                            <p>正在检查数据收集状态...</p>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <h5>🗑️ 数据管理</h5>
                        <button class="export-btn" onclick="clearStatisticsData()"
                            style="background: #dc3545; color: white;">
                            清除历史数据
                        </button>
                        <p style="font-size: 0.8rem; color: #6c757d; margin-top: 5px;">
                            注意：此操作将清除所有历史统计数据，无法恢复
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 成就解锁动画覆盖层 -->
    <div id="achievementUnlockOverlay" class="achievement-unlock-overlay" style="display: none;">
        <div class="achievement-unlock-animation">
            <div class="achievement-unlock-icon">🏆</div>
            <div class="achievement-unlock-title">成就解锁!</div>
            <div class="achievement-unlock-name" id="unlockedAchievementName"></div>
            <div class="achievement-unlock-description" id="unlockedAchievementDescription"></div>
            <div class="achievement-unlock-reward" id="unlockedAchievementReward"></div>
        </div>
    </div>

    <!-- 等级提升庆祝动画 -->
    <div id="levelUpOverlay" class="level-up-overlay" style="display: none;">
        <div class="level-up-animation">
            <div class="level-up-icon">🏢</div>
            <div class="level-up-title">等级提升!</div>
            <div class="level-up-level" id="levelUpNewLevel">2</div>
            <div class="level-up-rewards" id="levelUpRewards">
                获得奖励内容
            </div>
            <div class="level-up-unlocks" id="levelUpUnlocks">
                解锁新功能
            </div>
            <button class="level-up-continue" onclick="closeLevelUpAnimation()">继续游戏</button>
        </div>
    </div>

    <!-- 事件处理UI -->
    <div id="eventDialog" class="event-dialog-overlay" style="display: none;">
        <div class="event-dialog">
            <div class="event-dialog-header">
                <div class="event-type-indicator" id="eventTypeIndicator">📋</div>
                <div class="event-header-info">
                    <h3 id="eventTitle">事件标题</h3>
                    <div class="event-type-text" id="eventTypeText">随机事件</div>
                </div>
                <button class="event-close-btn" onclick="closeEventDialog()">✕</button>
            </div>
            <div class="event-dialog-content">
                <div class="event-description" id="eventDescription">
                    事件描述内容
                </div>
                <div class="event-choices" id="eventChoices">
                    <!-- 选择按钮将在这里动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 事件结果反馈 -->
    <div id="eventResultDialog" class="event-result-overlay" style="display: none;">
        <div class="event-result-dialog">
            <div class="event-result-header">
                <div class="event-result-icon" id="eventResultIcon">✅</div>
                <h3 id="eventResultTitle">处理结果</h3>
            </div>
            <div class="event-result-content">
                <div class="event-result-description" id="eventResultDescription">
                    处理结果描述
                </div>
                <div class="event-result-consequences" id="eventResultConsequences">
                    <!-- 后果将在这里显示 -->
                </div>
                <button class="event-result-ok-btn" onclick="closeEventResultDialog()">确定</button>
            </div>
        </div>
    </div>

    <!-- 员工详情面板 -->
    <div id="employeeDetailsPanel" class="employee-details-panel" style="display: none;">
        <div class="employee-details-header">
            <div class="employee-basic-info">
                <div class="employee-avatar" id="employeeAvatar">👤</div>
                <div class="employee-name-status">
                    <h3 class="employee-name" id="employeeName">员工姓名</h3>
                    <div class="employee-status" id="employeeCurrentStatus">当前状态</div>
                </div>
            </div>
            <button class="close-btn" onclick="closeEmployeeDetailsPanel()">✕</button>
        </div>
        <div class="employee-details-content">
            <!-- 个性特征部分 -->
            <div class="employee-section">
                <h4>🧠 个性特征</h4>
                <div class="personality-traits" id="personalityTraits">
                    <!-- 个性特征将在这里动态生成 -->
                </div>
                <div class="personality-tags" id="personalityTags">
                    <!-- 个性标签将在这里动态生成 -->
                </div>
            </div>

            <!-- 技能属性部分 -->
            <div class="employee-section">
                <h4>💪 技能属性</h4>
                <div class="skills-grid" id="skillsGrid">
                    <!-- 技能将在这里动态生成 -->
                </div>
            </div>

            <!-- 状态监控部分 -->
            <div class="employee-section">
                <h4>📊 状态监控</h4>
                <div class="status-indicators" id="statusIndicators">
                    <!-- 状态指标将在这里动态生成 -->
                </div>
            </div>

            <!-- 人际关系部分 -->
            <div class="employee-section">
                <h4>👥 人际关系</h4>
                <div class="relationships-section" id="relationshipsSection">
                    <!-- 人际关系将在这里动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 事件通知 -->
    <div id="eventNotifications" class="event-notifications">
        <!-- 事件通知将在这里动态添加 -->
    </div>

    <!-- 增强功能系统 -->
    <script src="time-manager.js"></script>
    <script src="personality-system.js"></script>
    <script src="facility-manager.js"></script>
    <script src="game-manager.js"></script>
    <script src="game.js"></script>

    <!-- 插件加载 -->
    <script src="plugins/air-conditioning-plugin.js"></script>
    <script src="plugins/printer-maintenance-plugin.js"></script>

    <script>
        // 插件管理界面
        window.addEventListener('load', () => {
            // 等待游戏加载完成后显示插件控制台信息
            setTimeout(() => {
                console.log('🎮 办公室生存游戏已加载');

                // 等待插件注册完成
                setTimeout(() => {
                    console.log('📦 可用插件:', window.game.getPluginList());
                    console.log('');
                    console.log('🔧 插件管理命令:');
                    console.log('  game.getPluginList() - 查看所有插件');
                    console.log('  game.activatePlugin("插件名称") - 激活插件');
                    console.log('  game.deactivatePlugin("插件名称") - 停用插件');
                    console.log('  game.getSolutions() - 查看已实施的解决方案');
                    console.log('');
                    console.log('💡 示例: game.activatePlugin("智能空调系统")');
                    console.log('🔧 如果插件未显示，请点击"调试插件"按钮');

                    // 启动增强功能UI更新
                    startEnhancedUI();
                }, 2000);
            }, 1000);
        });

        // 增强功能UI更新
        function startEnhancedUI() {
            // 显示增强功能统计
            const moneystat = document.getElementById('money-stat');
            const satisfactionStat = document.getElementById('satisfaction-stat');
            const reputationStat = document.getElementById('reputation-stat');
            const productivityStat = document.getElementById('productivity-stat');
            const achievementStat = document.getElementById('achievement-stat');

            if (moneystat) moneystat.style.display = 'block';
            if (satisfactionStat) satisfactionStat.style.display = 'block';
            if (reputationStat) reputationStat.style.display = 'block';
            if (productivityStat) productivityStat.style.display = 'block';
            if (achievementStat) achievementStat.style.display = 'block';

            // 定期更新增强功能数据
            setInterval(updateEnhancedStats, 1000);

            // 初始化资源变化追踪
            initializeResourceTracking();

            // 初始化成就UI
            initializeAchievementUI();

            // 初始化进展UI
            initializeProgressionUI();
        }

        // 资源变化追踪
        let previousResources = {};

        function initializeResourceTracking() {
            if (!window.game || !window.game.gameManager) return;

            const resourceSystem = window.game.gameManager.getResourceSystem();
            if (!resourceSystem) return;

            // 初始化上一次的资源值
            previousResources = {
                money: resourceSystem.getResource('money'),
                satisfaction: resourceSystem.getResource('satisfaction'),
                reputation: resourceSystem.getResource('reputation'),
                productivity: resourceSystem.getResource('productivity')
            };
        }

        // 更新增强功能统计
        function updateEnhancedStats() {
            if (!window.game || !window.game.gameManager) return;

            const resourceSystem = window.game.gameManager.getResourceSystem();
            if (!resourceSystem) return;

            // 获取当前资源值
            const currentResources = {
                money: Math.floor(resourceSystem.getResource('money')),
                satisfaction: Math.floor(resourceSystem.getResource('satisfaction')),
                reputation: Math.floor(resourceSystem.getResource('reputation')),
                productivity: Math.floor(resourceSystem.getResource('productivity'))
            };

            // 更新资金并显示变化
            const moneyElement = document.getElementById('moneyAmount');
            if (moneyElement) {
                moneyElement.textContent = currentResources.money.toLocaleString();

                // 显示资金变化动画
                if (previousResources.money !== undefined) {
                    const change = currentResources.money - previousResources.money;
                    if (change !== 0) {
                        showResourceChange(moneyElement.parentElement, change, change > 0 ? '#28a745' : '#dc3545');
                    }
                }
            }

            // 更新满意度并显示变化
            const satisfactionElement = document.getElementById('satisfactionLevel');
            if (satisfactionElement) {
                satisfactionElement.textContent = currentResources.satisfaction;

                // 根据满意度水平改变颜色
                const satisfactionStat = document.getElementById('satisfaction-stat');
                if (satisfactionStat) {
                    if (currentResources.satisfaction >= 70) {
                        satisfactionStat.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
                    } else if (currentResources.satisfaction >= 40) {
                        satisfactionStat.style.background = 'linear-gradient(135deg, #ffc107 0%, #fd7e14 100%)';
                    } else {
                        satisfactionStat.style.background = 'linear-gradient(135deg, #dc3545 0%, #e83e8c 100%)';
                    }
                }

                // 显示满意度变化
                if (previousResources.satisfaction !== undefined) {
                    const change = currentResources.satisfaction - previousResources.satisfaction;
                    if (Math.abs(change) >= 1) {
                        showResourceChange(satisfactionElement.parentElement, change, change > 0 ? '#28a745' : '#dc3545');
                    }
                }
            }

            // 更新声望并显示变化
            const reputationElement = document.getElementById('reputationLevel');
            if (reputationElement) {
                reputationElement.textContent = currentResources.reputation;

                // 根据声望水平改变颜色
                const reputationStat = document.getElementById('reputation-stat');
                if (reputationStat) {
                    if (currentResources.reputation >= 70) {
                        reputationStat.style.background = 'linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%)';
                    } else if (currentResources.reputation >= 40) {
                        reputationStat.style.background = 'linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%)';
                    } else {
                        reputationStat.style.background = 'linear-gradient(135deg, #6c757d 0%, #495057 100%)';
                    }
                }

                // 显示声望变化
                if (previousResources.reputation !== undefined) {
                    const change = currentResources.reputation - previousResources.reputation;
                    if (Math.abs(change) >= 1) {
                        showResourceChange(reputationElement.parentElement, change, change > 0 ? '#28a745' : '#dc3545');
                    }
                }
            }

            // 更新生产力并显示变化
            const productivityElement = document.getElementById('productivityLevel');
            if (productivityElement) {
                productivityElement.textContent = currentResources.productivity;

                // 根据生产力水平改变颜色
                const productivityStat = document.getElementById('productivity-stat');
                if (productivityStat) {
                    if (currentResources.productivity >= 70) {
                        productivityStat.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
                    } else if (currentResources.productivity >= 40) {
                        productivityStat.style.background = 'linear-gradient(135deg, #17a2b8 0%, #20c997 100%)';
                    } else {
                        productivityStat.style.background = 'linear-gradient(135deg, #dc3545 0%, #fd7e14 100%)';
                    }
                }

                // 显示生产力变化
                if (previousResources.productivity !== undefined) {
                    const change = currentResources.productivity - previousResources.productivity;
                    if (Math.abs(change) >= 1) {
                        showResourceChange(productivityElement.parentElement, change, change > 0 ? '#28a745' : '#dc3545');
                    }
                }
            }

            // 检查资源不足警告
            checkResourceWarnings(currentResources);

            // 更新上一次的资源值
            previousResources = { ...currentResources };
        }

        // 显示资源变化动画
        function showResourceChange(element, change, color) {
            const changeIndicator = document.createElement('div');
            changeIndicator.style.cssText = `
                position: absolute;
                top: -20px;
                right: 0;
                color: ${color};
                font-size: 12px;
                font-weight: bold;
                pointer-events: none;
                z-index: 1000;
                animation: resourceChange 2s ease-out forwards;
            `;
            changeIndicator.textContent = (change > 0 ? '+' : '') + change;

            // 添加动画样式
            if (!document.getElementById('resource-change-style')) {
                const style = document.createElement('style');
                style.id = 'resource-change-style';
                style.textContent = `
                    @keyframes resourceChange {
                        0% { opacity: 1; transform: translateY(0); }
                        100% { opacity: 0; transform: translateY(-10px); }
                    }
                `;
                document.head.appendChild(style);
            }

            // 确保父元素有相对定位
            element.style.position = 'relative';
            element.appendChild(changeIndicator);

            // 2秒后移除指示器
            setTimeout(() => {
                if (changeIndicator.parentNode) {
                    changeIndicator.parentNode.removeChild(changeIndicator);
                }
            }, 2000);
        }

        // 检查资源不足警告
        function checkResourceWarnings(resources) {
            // 资金不足警告
            if (resources.money < 5000) {
                showResourceWarning('资金不足！考虑提高员工生产力或减少支出', 'warning');
            }

            // 满意度过低警告
            if (resources.satisfaction < 30) {
                showResourceWarning('员工满意度过低！考虑激活改善插件', 'danger');
            }

            // 声望过低警告
            if (resources.reputation < 25) {
                showResourceWarning('公司声望过低！需要改善管理策略', 'danger');
            }
        }

        // 显示资源警告
        let lastWarningTime = 0;
        function showResourceWarning(message, type) {
            const now = Date.now();
            // 避免频繁显示警告（至少间隔10秒）
            if (now - lastWarningTime < 10000) return;

            lastWarningTime = now;

            const warning = document.createElement('div');
            warning.style.cssText = `
                position: fixed;
                top: 70px;
                right: 20px;
                background: ${type === 'danger' ? '#dc3545' : '#ffc107'};
                color: white;
                padding: 10px 15px;
                border-radius: 5px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                z-index: 1001;
                max-width: 300px;
                font-size: 13px;
                animation: slideIn 0.3s ease-out;
            `;
            warning.innerHTML = `⚠️ ${message}`;

            document.body.appendChild(warning);

            // 5秒后自动移除
            setTimeout(() => {
                warning.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => {
                    if (warning.parentNode) {
                        warning.parentNode.removeChild(warning);
                    }
                }, 300);
            }, 5000);
        }

        // 简单的通知系统
        window.showNotification = function (message, type = 'info') {
            console.log(`🔔 通知 [${type}]: ${message}`);

            // 创建通知元素
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'achievement' ? '#28a745' : type === 'levelup' ? '#ffc107' : '#17a2b8'};
                color: white;
                padding: 10px 15px;
                border-radius: 5px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                z-index: 1000;
                max-width: 300px;
                font-size: 14px;
                animation: slideIn 0.3s ease-out;
            `;
            notification.textContent = message;

            // 添加动画样式
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);

            document.body.appendChild(notification);

            // 3秒后自动移除
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        };

        // 事件对话框系统
        let currentEvent = null;

        window.showEventDialog = function (event) {
            console.log(`🎲 事件对话框: ${event.name}`);

            currentEvent = event;

            // 显示事件通知
            showEventNotification(event);

            // 显示详细事件对话框
            displayEventDialog(event);
        };

        // 显示事件通知
        function showEventNotification(event) {
            const notificationsContainer = document.getElementById('eventNotifications');
            if (!notificationsContainer) return;

            const notification = document.createElement('div');
            notification.className = `event-notification ${event.type || 'random'}`;

            const eventTypeNames = {
                'random': '随机事件',
                'emergency': '紧急事件',
                'scheduled': '计划事件',
                'opportunity': '机会事件',
                'special': '特殊事件'
            };

            const eventIcons = {
                'random': '🎲',
                'emergency': '🚨',
                'scheduled': '📅',
                'opportunity': '💡',
                'special': '⭐'
            };

            notification.innerHTML = `
                <div class="event-notification-header">
                    <div class="event-notification-icon">${eventIcons[event.type] || '📋'}</div>
                    <div class="event-notification-title">${event.name}</div>
                    <div class="event-notification-type">${eventTypeNames[event.type] || '事件'}</div>
                </div>
                <div class="event-notification-description">${event.description}</div>
                <div class="event-notification-footer">
                    <div class="event-notification-time">刚刚</div>
                    <div class="event-notification-action">点击处理</div>
                </div>
            `;

            // 点击通知显示详细对话框
            notification.onclick = () => {
                displayEventDialog(event);
                // 移除通知
                notification.style.animation = 'slideOutRight 0.3s ease-out';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            };

            notificationsContainer.appendChild(notification);

            // 5秒后自动移除通知
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOutRight 0.3s ease-out';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }
            }, 5000);
        }

        // 显示详细事件对话框
        function displayEventDialog(event) {
            const dialog = document.getElementById('eventDialog');
            const typeIndicator = document.getElementById('eventTypeIndicator');
            const title = document.getElementById('eventTitle');
            const typeText = document.getElementById('eventTypeText');
            const description = document.getElementById('eventDescription');
            const choicesContainer = document.getElementById('eventChoices');

            if (!dialog) return;

            // 设置事件类型图标和颜色
            const eventTypeData = {
                'random': { icon: '🎲', text: '随机事件', color: '#667eea' },
                'emergency': { icon: '🚨', text: '紧急事件', color: '#dc3545' },
                'scheduled': { icon: '📅', text: '计划事件', color: '#28a745' },
                'opportunity': { icon: '💡', text: '机会事件', color: '#ffc107' },
                'special': { icon: '⭐', text: '特殊事件', color: '#6f42c1' }
            };

            const typeData = eventTypeData[event.type] || eventTypeData['random'];

            typeIndicator.textContent = typeData.icon;
            title.textContent = event.name;
            typeText.textContent = typeData.text;
            description.textContent = event.description;

            // 更新对话框头部颜色
            const header = dialog.querySelector('.event-dialog-header');
            header.style.background = `linear-gradient(135deg, ${typeData.color} 0%, ${adjustColor(typeData.color, -20)} 100%)`;

            // 生成选择按钮
            choicesContainer.innerHTML = '';
            event.choices.forEach((choice, index) => {
                const button = document.createElement('button');
                button.className = `event-choice-btn ${getChoiceButtonClass(choice, index)}`;

                const costText = formatChoiceCost(choice.cost);
                const consequencesText = formatChoiceConsequences(choice.consequences);

                button.innerHTML = `
                    <span class="event-choice-text">${choice.text}</span>
                    ${costText ? `<span class="event-choice-cost">成本: ${costText}</span>` : ''}
                    ${consequencesText ? `<span class="event-choice-consequences">影响: ${consequencesText}</span>` : ''}
                `;

                button.onclick = () => handleEventChoice(event.id, index, choice);
                choicesContainer.appendChild(button);
            });

            dialog.style.display = 'flex';
        }

        // 获取选择按钮样式类
        function getChoiceButtonClass(choice, index) {
            // 根据成本和后果确定按钮样式
            const cost = choice.cost || {};
            const consequences = choice.consequences || {};

            const hasCost = Object.keys(cost).length > 0;
            const hasPositiveConsequences = Object.values(consequences).some(val => val > 0);
            const hasNegativeConsequences = Object.values(consequences).some(val => val < 0);

            if (index === 0) {
                return hasPositiveConsequences ? 'primary' : hasCost ? 'warning' : 'secondary';
            } else {
                return hasNegativeConsequences ? 'danger' : 'secondary';
            }
        }

        // 格式化选择成本
        function formatChoiceCost(cost) {
            if (!cost || Object.keys(cost).length === 0) return '';

            const costParts = [];
            const resourceIcons = {
                money: '💰',
                reputation: '⭐',
                satisfaction: '😊',
                productivity: '📈'
            };

            for (const [resource, amount] of Object.entries(cost)) {
                const icon = resourceIcons[resource] || resource;
                costParts.push(`${icon}${amount}`);
            }

            return costParts.join(' ');
        }

        // 格式化选择后果
        function formatChoiceConsequences(consequences) {
            if (!consequences || Object.keys(consequences).length === 0) return '';

            const consequenceParts = [];
            const resourceIcons = {
                money: '💰',
                reputation: '⭐',
                satisfaction: '😊',
                productivity: '📈'
            };

            for (const [resource, amount] of Object.entries(consequences)) {
                const icon = resourceIcons[resource] || resource;
                const sign = amount > 0 ? '+' : '';
                consequenceParts.push(`${icon}${sign}${amount}`);
            }

            return consequenceParts.join(' ');
        }

        // 处理事件选择
        function handleEventChoice(eventId, choiceIndex, choice) {
            console.log(`处理事件选择: ${eventId}, 选择: ${choiceIndex}`);

            // 检查资源是否足够
            if (choice.cost && !canAffordEventChoice(choice.cost)) {
                showResourceWarning('资源不足，无法执行此选择！', 'danger');
                return;
            }

            // 关闭事件对话框
            closeEventDialog();

            // 处理事件
            if (window.game && window.game.gameManager) {
                const eventSystem = window.game.gameManager.getEventSystem();
                if (eventSystem) {
                    const success = eventSystem.processEvent(eventId, choiceIndex);
                    if (success) {
                        // 显示结果对话框
                        showEventResult(currentEvent, choice, choiceIndex);
                    }
                }
            }
        }

        // 检查是否能承担事件选择成本
        function canAffordEventChoice(cost) {
            if (!cost || Object.keys(cost).length === 0) return true;
            if (!window.game || !window.game.gameManager) return false;

            const resourceSystem = window.game.gameManager.getResourceSystem();
            if (!resourceSystem) return false;

            for (const [resource, amount] of Object.entries(cost)) {
                if (resourceSystem.getResource(resource) < amount) {
                    return false;
                }
            }
            return true;
        }

        // 显示事件结果
        function showEventResult(event, choice, choiceIndex) {
            const resultDialog = document.getElementById('eventResultDialog');
            const resultIcon = document.getElementById('eventResultIcon');
            const resultTitle = document.getElementById('eventResultTitle');
            const resultDescription = document.getElementById('eventResultDescription');
            const consequencesContainer = document.getElementById('eventResultConsequences');

            if (!resultDialog) return;

            // 设置结果图标和标题
            const isPositiveChoice = Object.values(choice.consequences || {}).some(val => val > 0);
            const isNegativeChoice = Object.values(choice.consequences || {}).some(val => val < 0);

            if (isPositiveChoice && !isNegativeChoice) {
                resultIcon.textContent = '✅';
                resultTitle.textContent = '处理成功';
                resultDialog.querySelector('.event-result-header').style.background =
                    'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
            } else if (isNegativeChoice && !isPositiveChoice) {
                resultIcon.textContent = '⚠️';
                resultTitle.textContent = '处理完成';
                resultDialog.querySelector('.event-result-header').style.background =
                    'linear-gradient(135deg, #ffc107 0%, #fd7e14 100%)';
            } else {
                resultIcon.textContent = '📋';
                resultTitle.textContent = '处理完成';
                resultDialog.querySelector('.event-result-header').style.background =
                    'linear-gradient(135deg, #6c757d 0%, #495057 100%)';
            }

            resultDescription.textContent = `你选择了"${choice.text}"，以下是处理结果：`;

            // 显示后果
            consequencesContainer.innerHTML = '';
            if (choice.consequences) {
                for (const [resource, amount] of Object.entries(choice.consequences)) {
                    const consequenceItem = document.createElement('div');
                    consequenceItem.className = `consequence-item ${amount > 0 ? 'positive' : amount < 0 ? 'negative' : 'neutral'}`;

                    const resourceIcons = {
                        money: '💰',
                        reputation: '⭐',
                        satisfaction: '😊',
                        productivity: '📈'
                    };

                    const icon = resourceIcons[resource] || resource;
                    const sign = amount > 0 ? '+' : '';
                    consequenceItem.innerHTML = `${icon} ${sign}${amount}`;

                    consequencesContainer.appendChild(consequenceItem);
                }
            }

            resultDialog.style.display = 'flex';
        }

        // 关闭事件对话框
        function closeEventDialog() {
            const dialog = document.getElementById('eventDialog');
            if (dialog) {
                dialog.style.display = 'none';
            }
            currentEvent = null;
        }

        // 关闭事件结果对话框
        function closeEventResultDialog() {
            const dialog = document.getElementById('eventResultDialog');
            if (dialog) {
                dialog.style.display = 'none';
            }
        }

        // 颜色调整辅助函数
        function adjustColor(color, percent) {
            const num = parseInt(color.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
        }

        // ===== 进展UI系统 =====

        // 初始化进展UI
        function initializeProgressionUI() {
            // 显示等级和经验统计
            const levelStat = document.getElementById('level-stat');
            const experienceStat = document.getElementById('experience-stat');

            if (levelStat) levelStat.style.display = 'block';
            if (experienceStat) experienceStat.style.display = 'block';

            // 定期更新进展数据
            setInterval(updateProgressionStats, 1000);

            // 初始化进展面板内容
            updateProgressionPanel();
        }

        // 更新进展统计
        function updateProgressionStats() {
            if (!window.game || !window.game.gameManager) return;

            const progressionSystem = window.game.gameManager.getProgressionSystem();
            if (!progressionSystem) return;

            const progressData = progressionSystem.getLevelProgress();

            // 更新等级显示
            const levelElement = document.getElementById('companyLevel');
            if (levelElement) {
                levelElement.textContent = progressData.level;
            }

            // 更新经验显示
            const experienceElement = document.getElementById('experiencePoints');
            const experienceToNextElement = document.getElementById('experienceToNext');
            if (experienceElement && experienceToNextElement) {
                experienceElement.textContent = progressData.experience;
                experienceToNextElement.textContent = progressData.experienceToNext;
            }

            // 更新进展面板统计
            updateProgressionPanelStats(progressData, progressionSystem);
        }

        // 更新进展面板统计
        function updateProgressionPanelStats(progressData, progressionSystem) {
            // 更新面板顶部统计
            const currentLevelElement = document.getElementById('progressionCurrentLevel');
            const employeeCapacityElement = document.getElementById('progressionEmployeeCapacity');
            const unlockedFeaturesElement = document.getElementById('progressionUnlockedFeatures');
            const floorsElement = document.getElementById('progressionFloors');

            if (currentLevelElement) {
                currentLevelElement.textContent = progressData.level;
            }

            if (employeeCapacityElement) {
                employeeCapacityElement.textContent = progressionSystem.currentEmployeeCapacity;
            }

            if (unlockedFeaturesElement) {
                unlockedFeaturesElement.textContent = progressionSystem.unlockedFeatures.size;
            }

            if (floorsElement) {
                floorsElement.textContent = progressionSystem.maxFloors;
            }

            // 更新概览标签页内容
            updateProgressionOverview(progressData, progressionSystem);
        }

        // 更新进展概览
        function updateProgressionOverview(progressData, progressionSystem) {
            // 更新等级显示
            const currentLevelDisplay = document.getElementById('currentLevelDisplay');
            const currentExperience = document.getElementById('currentExperience');
            const experienceRequired = document.getElementById('experienceRequired');
            const experienceRemaining = document.getElementById('experienceRemaining');
            const levelProgressFill = document.getElementById('levelProgressFill');
            const levelProgressText = document.getElementById('levelProgressText');

            if (currentLevelDisplay) {
                currentLevelDisplay.textContent = progressData.level;
            }

            if (currentExperience) {
                currentExperience.textContent = progressData.experience.toLocaleString();
            }

            if (experienceRequired) {
                experienceRequired.textContent = progressData.experienceToNext.toLocaleString();
            }

            if (experienceRemaining) {
                const remaining = progressData.experienceToNext - progressData.experience;
                experienceRemaining.textContent = remaining.toLocaleString();
            }

            // 更新进度条
            const progressPercent = Math.floor(progressData.progress);
            if (levelProgressFill) {
                levelProgressFill.style.width = `${progressPercent}%`;
            }

            if (levelProgressText) {
                levelProgressText.textContent = `${progressPercent}%`;
            }

            // 更新下一级解锁内容
            updateNextLevelUnlocks(progressionSystem);
        }

        // 更新下一级解锁内容
        function updateNextLevelUnlocks(progressionSystem) {
            const nextLevelUnlocksContainer = document.getElementById('nextLevelUnlocks');
            if (!nextLevelUnlocksContainer) return;

            const nextLevel = progressionSystem.companyLevel + 1;
            const unlockPreview = progressionSystem.getLevelUnlockPreview(nextLevel);

            nextLevelUnlocksContainer.innerHTML = '';

            if (unlockPreview.unlockDetails && unlockPreview.unlockDetails.length > 0) {
                unlockPreview.unlockDetails.forEach(unlock => {
                    const unlockItem = document.createElement('div');
                    unlockItem.className = 'unlock-item';

                    const categoryIcons = {
                        'management': '👥',
                        'analytics': '📊',
                        'employee': '👤',
                        'facility': '🏢',
                        'expansion': '🏗️',
                        'business': '💼',
                        'technology': '💻',
                        'luxury': '💎',
                        'achievement': '🏆',
                        'automation': '🤖'
                    };

                    const icon = categoryIcons[unlock.category] || '🔓';

                    unlockItem.innerHTML = `
                        <div class="unlock-icon">${icon}</div>
                        <div class="unlock-info">
                            <div class="unlock-name">${unlock.name}</div>
                            <div class="unlock-description">${unlock.description}</div>
                        </div>
                        <div class="unlock-level">等级 ${nextLevel}</div>
                    `;

                    nextLevelUnlocksContainer.appendChild(unlockItem);
                });
            } else {
                nextLevelUnlocksContainer.innerHTML = `
                    <div class="unlock-item">
                        <div class="unlock-icon">🎉</div>
                        <div class="unlock-info">
                            <div class="unlock-name">继续发展</div>
                            <div class="unlock-description">继续经营公司，解锁更多功能</div>
                        </div>
                        <div class="unlock-level">等级 ${nextLevel}</div>
                    </div>
                `;
            }
        }

        // 切换进展面板显示/隐藏
        function toggleProgressionPanel() {
            const panel = document.getElementById('progressionPanel');
            if (!panel) return;

            if (panel.style.display === 'none' || panel.style.display === '') {
                panel.style.display = 'flex';
                updateProgressionPanel();
            } else {
                panel.style.display = 'none';
            }
        }

        // 更新进展面板
        function updateProgressionPanel() {
            if (!window.game || !window.game.gameManager) return;

            const progressionSystem = window.game.gameManager.getProgressionSystem();
            if (!progressionSystem) return;

            const progressData = progressionSystem.getLevelProgress();
            updateProgressionPanelStats(progressData, progressionSystem);

            // 更新其他标签页内容
            updateProgressionUnlocksTab(progressionSystem);
            updateProgressionMilestonesTab(progressionSystem);
            updateProgressionFloorsTab(progressionSystem);
        }

        // 显示进展标签页
        function showProgressionTab(tabName) {
            // 隐藏所有标签页内容
            const tabContents = document.querySelectorAll('.progression-tab-content');
            tabContents.forEach(content => {
                content.style.display = 'none';
            });

            // 移除所有标签页的激活状态
            const tabs = document.querySelectorAll('.progression-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // 显示选中的标签页内容
            const selectedContent = document.getElementById(`progression${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`);
            if (selectedContent) {
                selectedContent.style.display = 'block';
            }

            // 激活选中的标签页
            const selectedTab = document.querySelector(`.progression-tab[onclick="showProgressionTab('${tabName}')"]`);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }

            // 根据标签页更新内容
            if (!window.game || !window.game.gameManager) return;
            const progressionSystem = window.game.gameManager.getProgressionSystem();
            if (!progressionSystem) return;

            switch (tabName) {
                case 'overview':
                    const progressData = progressionSystem.getLevelProgress();
                    updateProgressionOverview(progressData, progressionSystem);
                    break;
                case 'unlocks':
                    updateProgressionUnlocksTab(progressionSystem);
                    break;
                case 'milestones':
                    updateProgressionMilestonesTab(progressionSystem);
                    break;
                case 'floors':
                    updateProgressionFloorsTab(progressionSystem);
                    break;
            }
        }

        // 更新解锁预览标签页
        function updateProgressionUnlocksTab(progressionSystem) {
            const futureUnlocksContainer = document.getElementById('futureUnlocks');
            if (!futureUnlocksContainer) return;

            const upcomingUnlocks = progressionSystem.getUpcomingUnlocks(5);
            futureUnlocksContainer.innerHTML = '';

            upcomingUnlocks.forEach(unlockPreview => {
                if (unlockPreview.unlockDetails && unlockPreview.unlockDetails.length > 0) {
                    unlockPreview.unlockDetails.forEach(unlock => {
                        const unlockItem = document.createElement('div');
                        unlockItem.className = 'unlock-item';

                        const categoryIcons = {
                            'management': '👥',
                            'analytics': '📊',
                            'employee': '👤',
                            'facility': '🏢',
                            'expansion': '🏗️',
                            'business': '💼',
                            'technology': '💻',
                            'luxury': '💎',
                            'achievement': '🏆',
                            'automation': '🤖'
                        };

                        const icon = categoryIcons[unlock.category] || '🔓';

                        unlockItem.innerHTML = `
                            <div class="unlock-icon">${icon}</div>
                            <div class="unlock-info">
                                <div class="unlock-name">${unlock.name}</div>
                                <div class="unlock-description">${unlock.description}</div>
                            </div>
                            <div class="unlock-level">等级 ${unlockPreview.level}</div>
                        `;

                        futureUnlocksContainer.appendChild(unlockItem);
                    });
                }
            });

            if (futureUnlocksContainer.children.length === 0) {
                futureUnlocksContainer.innerHTML = `
                    <div class="unlock-item">
                        <div class="unlock-icon">🎯</div>
                        <div class="unlock-info">
                            <div class="unlock-name">继续努力</div>
                            <div class="unlock-description">继续发展公司以解锁更多功能</div>
                        </div>
                        <div class="unlock-level">未来</div>
                    </div>
                `;
            }
        }

        // 更新里程碑标签页
        function updateProgressionMilestonesTab(progressionSystem) {
            const milestoneListContainer = document.getElementById('milestoneList');
            if (!milestoneListContainer) return;

            const milestones = progressionSystem.getMilestoneProgress();
            milestoneListContainer.innerHTML = '';

            milestones.forEach(milestone => {
                const milestoneItem = document.createElement('div');
                milestoneItem.className = `milestone-item ${milestone.completed ? 'completed' : milestone.progress > 0 ? 'in-progress' : ''}`;

                const categoryIcons = {
                    'employees': '👥',
                    'financial': '💰',
                    'reputation': '⭐',
                    'satisfaction': '😊',
                    'time': '⏰'
                };

                const icon = categoryIcons[milestone.category] || '🏁';

                const progressPercent = Math.floor(milestone.progress);
                const rewardText = formatMilestoneRewards(milestone.rewards);

                milestoneItem.innerHTML = `
                    <div class="milestone-icon ${milestone.completed ? 'completed' : ''}">${icon}</div>
                    <div class="milestone-info">
                        <div class="milestone-name">${milestone.name}</div>
                        <div class="milestone-description">${milestone.description}</div>
                        <div class="milestone-progress">
                            <div class="milestone-progress-bar">
                                <div class="milestone-progress-fill" style="width: ${progressPercent}%"></div>
                            </div>
                            <div class="milestone-progress-text">${progressPercent}%</div>
                        </div>
                        ${rewardText ? `<div class="milestone-reward">奖励: ${rewardText}</div>` : ''}
                    </div>
                `;

                milestoneListContainer.appendChild(milestoneItem);
            });
        }

        // 格式化里程碑奖励
        function formatMilestoneRewards(rewards) {
            if (!rewards) return '';

            const rewardParts = [];
            const resourceIcons = {
                money: '💰',
                reputation: '⭐',
                satisfaction: '😊',
                productivity: '📈',
                experience: '⭐'
            };

            for (const [resource, amount] of Object.entries(rewards)) {
                if (resource === 'features' || resource === 'floors') continue;
                const icon = resourceIcons[resource] || resource;
                rewardParts.push(`${icon}${amount}`);
            }

            return rewardParts.join(' ');
        }

        // 更新楼层管理标签页
        function updateProgressionFloorsTab(progressionSystem) {
            const floorListContainer = document.getElementById('floorList');
            if (!floorListContainer) return;

            const floors = progressionSystem.getAllFloors();
            floorListContainer.innerHTML = '';

            floors.forEach(floor => {
                const floorItem = document.createElement('div');
                floorItem.className = `milestone-item ${floor.unlocked ? 'completed' : ''}`;

                const floorIcons = ['', '🏢', '🏬', '🏭', '🏗️', '🏛️'];
                const icon = floorIcons[floor.id] || '🏢';

                const occupancyPercent = floor.capacity > 0 ? Math.floor((floor.currentEmployees / floor.capacity) * 100) : 0;

                floorItem.innerHTML = `
                    <div class="milestone-icon ${floor.unlocked ? 'completed' : ''}">${icon}</div>
                    <div class="milestone-info">
                        <div class="milestone-name">${floor.name}</div>
                        <div class="milestone-description">${floor.description}</div>
                        ${floor.unlocked ? `
                            <div class="milestone-progress">
                                <div class="milestone-progress-bar">
                                    <div class="milestone-progress-fill" style="width: ${occupancyPercent}%"></div>
                                </div>
                                <div class="milestone-progress-text">${floor.currentEmployees}/${floor.capacity}</div>
                            </div>
                            <div class="milestone-reward">维护成本: 💰${floor.maintenanceCost}/5分钟</div>
                        ` : `
                            <div class="milestone-reward">需要解锁</div>
                        `}
                    </div>
                `;

                floorListContainer.appendChild(floorItem);
            });
        }

        // 等级提升庆祝动画
        window.showLevelUpAnimation = function (level, rewards, unlocks) {
            console.log(`🎉 等级提升动画: 等级 ${level}`);

            const overlay = document.getElementById('levelUpOverlay');
            const levelElement = document.getElementById('levelUpNewLevel');
            const rewardsElement = document.getElementById('levelUpRewards');
            const unlocksElement = document.getElementById('levelUpUnlocks');

            if (!overlay) return;

            // 设置等级
            if (levelElement) {
                levelElement.textContent = level;
            }

            // 设置奖励信息
            if (rewardsElement && rewards) {
                const rewardTexts = [];
                if (rewards.money) rewardTexts.push(`💰 +${rewards.money.toLocaleString()}元`);
                if (rewards.reputation) rewardTexts.push(`⭐ +${rewards.reputation}声望`);
                if (rewards.satisfaction) rewardTexts.push(`😊 +${rewards.satisfaction}满意度`);
                if (rewards.productivity) rewardTexts.push(`📈 +${rewards.productivity}生产力`);

                rewardsElement.innerHTML = rewardTexts.join('<br>');
            }

            // 设置解锁信息
            if (unlocksElement && unlocks && unlocks.length > 0) {
                const unlockTexts = unlocks.map(unlock => `🔓 ${unlock}`);
                unlocksElement.innerHTML = unlockTexts.join('<br>');
            } else if (unlocksElement) {
                unlocksElement.innerHTML = '🎯 继续发展解锁更多功能';
            }

            // 显示动画
            overlay.style.display = 'flex';

            // 5秒后自动关闭
            setTimeout(() => {
                closeLevelUpAnimation();
            }, 5000);
        };

        // 关闭等级提升动画
        function closeLevelUpAnimation() {
            const overlay = document.getElementById('levelUpOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
        }

        // 关闭事件对话框
        function closeEventDialog() {
            const dialog = document.getElementById('eventDialog');
            if (dialog) {
                dialog.style.display = 'none';
            }
            currentEvent = null;
        }

        // 关闭事件结果对话框
        function closeEventResultDialog() {
            const resultDialog = document.getElementById('eventResultDialog');
            if (resultDialog) {
                resultDialog.style.display = 'none';
            }
        }

        // 关闭员工详情面板
        function closeEmployeeDetailsPanel() {
            const panel = document.getElementById('employeeDetailsPanel');
            if (panel) {
                panel.style.display = 'none';
            }
        }

        // 颜色调整辅助函数
        function adjustColor(color, percent) {
            const num = parseInt(color.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
        }

        // 插件UI控制函数
        function togglePlugin(pluginName, pluginId) {
            console.log('尝试切换插件:', pluginName, pluginId);

            if (!window.game) {
                console.error('游戏对象未找到');
                return;
            }

            const plugin = window.game.plugins.get(pluginName);
            if (!plugin) {
                console.error('插件未找到:', pluginName);
                console.log('可用插件:', Array.from(window.game.plugins.keys()));
                return;
            }

            const card = document.getElementById(`${pluginId}-plugin-card`);
            const status = document.getElementById(`${pluginId}-status`);
            const toggle = document.getElementById(`${pluginId}-toggle`);
            const settings = document.getElementById(`${pluginId}-settings`);

            if (plugin.isActive) {
                // 停用插件
                console.log('停用插件:', pluginName);
                const success = window.game.deactivatePlugin(pluginName);
                if (success && card && status && toggle) {
                    card.classList.remove('active');
                    status.textContent = '未激活';
                    status.classList.remove('active');
                    toggle.textContent = '激活插件';
                    if (settings) settings.style.display = 'none';
                }
            } else {
                // 检查资源是否足够激活插件
                const pluginCost = getPluginCost(pluginName);
                if (pluginCost && !canAffordPlugin(pluginCost)) {
                    showResourceWarning(`资源不足！激活${pluginName}需要: ${formatCost(pluginCost)}`, 'danger');
                    return;
                }

                // 激活插件
                console.log('激活插件:', pluginName);

                // 扣除激活成本
                if (pluginCost) {
                    spendResourcesForPlugin(pluginCost);
                }

                const success = window.game.activatePlugin(pluginName);
                if (success && card && status && toggle) {
                    card.classList.add('active');
                    status.textContent = '已激活';
                    status.classList.add('active');
                    toggle.textContent = '停用插件';
                    if (settings) settings.style.display = 'block';
                }
            }
        }

        // 获取插件激活成本
        function getPluginCost(pluginName) {
            const costs = {
                '智能空调系统': { money: 5000, reputation: 5 },
                '打印机维护系统': { money: 3000, reputation: 3 }
            };
            return costs[pluginName] || null;
        }

        // 检查是否能承担插件成本
        function canAffordPlugin(cost) {
            if (!window.game || !window.game.gameManager) return false;

            const resourceSystem = window.game.gameManager.getResourceSystem();
            if (!resourceSystem) return false;

            for (const [resource, amount] of Object.entries(cost)) {
                if (resourceSystem.getResource(resource) < amount) {
                    return false;
                }
            }
            return true;
        }

        // 为插件扣除资源
        function spendResourcesForPlugin(cost) {
            if (!window.game || !window.game.gameManager) return;

            const resourceSystem = window.game.gameManager.getResourceSystem();
            if (!resourceSystem) return;

            for (const [resource, amount] of Object.entries(cost)) {
                resourceSystem.spendResource(resource, amount);
            }
        }

        // 格式化成本显示
        function formatCost(cost) {
            const parts = [];
            for (const [resource, amount] of Object.entries(cost)) {
                const resourceNames = {
                    money: '资金',
                    reputation: '声望',
                    satisfaction: '满意度',
                    productivity: '生产力'
                };
                parts.push(`${resourceNames[resource] || resource}: ${amount}`);
            }
            return parts.join(', ');
        }

        // 空调插件特定功能
        function adjustTemperature(level) {
            const plugin = window.game.plugins.get('智能空调系统');
            if (plugin && plugin.isActive && plugin.adjustTemperature) {
                plugin.adjustTemperature(parseInt(level));

                const levelNames = ['', '正常', '舒适', '完美'];
                console.log(`🌡️ 温度调节至: ${levelNames[level]}`);
            }
        }

        // 打印机插件特定功能
        function emergencyRepair() {
            const plugin = window.game.plugins.get('打印机维护系统');
            if (plugin && plugin.isActive && plugin.emergencyRepair) {
                plugin.emergencyRepair();

                // 更新UI反馈
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = '✅ 维修完成';
                button.disabled = true;

                setTimeout(() => {
                    button.textContent = originalText;
                    button.disabled = false;
                }, 3000);
            }
        }



        // 更新备用打印机数量显示
        function updateBackupPrinterCount() {
            const plugin = window.game.plugins.get('打印机维护系统');
            if (plugin && plugin.backupPrinters !== undefined) {
                const countSpan = document.getElementById('backup-count');
                if (countSpan) {
                    countSpan.textContent = plugin.backupPrinters;
                }
            }
        }

        // 定期更新插件状态显示
        setInterval(() => {
            updateBackupPrinterCount();


        }, 5000);

        // 测试增强功能
        function testEnhancedFeatures() {
            console.log('=== 增强功能测试 ===');

            if (!window.game) {
                console.error('游戏对象未找到');
                return;
            }

            if (!window.game.gameManager) {
                console.error('GameManager 未初始化');
                return;
            }

            const gameManager = window.game.gameManager;

            // 测试资源系统
            const resourceSystem = gameManager.getResourceSystem();
            if (resourceSystem) {
                console.log('💰 当前资源状态:');
                console.log('  资金:', resourceSystem.getResource('money'));
                console.log('  满意度:', resourceSystem.getResource('satisfaction'));
                console.log('  声望:', resourceSystem.getResource('reputation'));
                console.log('  生产力:', resourceSystem.getResource('productivity'));

                // 测试资源操作
                resourceSystem.addResource('money', 5000);
                console.log('✅ 添加5000资金测试完成');

                resourceSystem.addResource('satisfaction', 10);
                console.log('✅ 添加10满意度测试完成');
            }

            // 测试成就系统
            const achievementSystem = gameManager.getAchievementSystem();
            if (achievementSystem) {
                console.log('🏆 成就系统状态:');
                console.log('  总成就数:', achievementSystem.achievements.size);
                console.log('  已解锁:', achievementSystem.unlockedAchievements.size);

                // 显示成就摘要
                const summary = achievementSystem.getAchievementSummary();
                console.log('  完成度:', summary.completionRate + '%');
                console.log('  类别统计:', summary.categoryStats);

                // 手动检查成就
                achievementSystem.checkAchievements();
                console.log('✅ 成就检查测试完成');

                // 显示成就面板
                console.log('💡 提示: 点击"成就面板"按钮查看详细成就信息');
            }

            // 测试事件系统
            const eventSystem = gameManager.getEventSystem();
            if (eventSystem) {
                console.log('🎲 事件系统状态:');
                console.log('  总事件数:', eventSystem.events.size);
                console.log('  活跃事件:', eventSystem.activeEvents.size);

                // 触发测试事件
                const testEvent = eventSystem.triggerRandomEvent();
                if (testEvent) {
                    console.log('✅ 随机事件触发测试完成:', testEvent.name);
                }
            }

            // 测试进展系统
            const progressionSystem = gameManager.getProgressionSystem();
            if (progressionSystem) {
                console.log('📈 进展系统状态:');
                console.log('  当前等级:', progressionSystem.level);
                console.log('  经验值:', progressionSystem.experience);
                console.log('  下级所需:', progressionSystem.experienceToNext);

                // 添加测试经验
                progressionSystem.addExperience(100, '测试');
                console.log('✅ 经验添加测试完成');
            }

            console.log('=== 测试完成 ===');
        }

        // 成就UI相关函数
        let currentAchievementTab = 'all';

        // 初始化成就UI
        function initializeAchievementUI() {
            // 定期更新成就显示
            setInterval(updateAchievementDisplay, 2000);
        }

        // 切换成就面板显示
        function toggleAchievementPanel() {
            const panel = document.getElementById('achievementPanel');
            if (panel.style.display === 'none' || !panel.style.display) {
                panel.style.display = 'flex';
                updateAchievementPanel();
            } else {
                panel.style.display = 'none';
            }
        }

        // 显示成就标签页
        function showAchievementTab(tabName) {
            currentAchievementTab = tabName;

            // 更新标签页样式
            document.querySelectorAll('.achievement-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // 更新成就列表
            updateAchievementList();
        }

        // 更新成就面板
        function updateAchievementPanel() {
            if (!window.game || !window.game.gameManager) return;

            const achievementSystem = window.game.gameManager.getAchievementSystem();
            if (!achievementSystem) return;

            const summary = achievementSystem.getAchievementSummary();

            // 更新统计信息
            document.getElementById('achievementCompletionRate').textContent = summary.completionRate + '%';
            document.getElementById('achievementUnlocked').textContent = summary.unlocked;
            document.getElementById('achievementTotal').textContent = summary.total;

            // 更新成就列表
            updateAchievementList();
        }

        // 更新成就列表
        function updateAchievementList() {
            if (!window.game || !window.game.gameManager) return;

            const achievementSystem = window.game.gameManager.getAchievementSystem();
            if (!achievementSystem) return;

            const allAchievements = achievementSystem.getAllAchievements();
            let filteredAchievements = [];

            switch (currentAchievementTab) {
                case 'unlocked':
                    filteredAchievements = allAchievements.filter(a => a.unlocked);
                    break;
                case 'locked':
                    filteredAchievements = allAchievements.filter(a => !a.unlocked);
                    break;
                case 'recent':
                    filteredAchievements = achievementSystem.getUnlockedAchievements().slice(-10);
                    break;
                default:
                    filteredAchievements = allAchievements;
            }

            const listContainer = document.getElementById('achievementList');
            listContainer.innerHTML = '';

            filteredAchievements.forEach(achievement => {
                const achievementElement = createAchievementElement(achievement);
                listContainer.appendChild(achievementElement);
            });

            if (filteredAchievements.length === 0) {
                listContainer.innerHTML = '<div style="text-align: center; color: #6c757d; padding: 20px;">暂无成就</div>';
            }
        }

        // 创建成就元素
        function createAchievementElement(achievement) {
            const element = document.createElement('div');
            element.className = `achievement-item ${achievement.unlocked ? 'unlocked' : ''}`;

            const icon = achievement.icon || '🏆';
            const progress = achievement.progress || 0;
            const progressText = achievement.unlocked ? '已完成' : `${Math.floor(progress)}%`;

            // 格式化奖励文本
            const rewardText = formatRewardText(achievement.reward);

            element.innerHTML = `
                <div class="achievement-icon">${icon}</div>
                <div class="achievement-info">
                    <div class="achievement-name">${achievement.name}</div>
                    <div class="achievement-description">${achievement.description}</div>
                    <div class="achievement-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                        <div class="progress-text">${progressText}</div>
                    </div>
                    ${rewardText ? `<div class="achievement-reward">奖励: ${rewardText}</div>` : ''}
                </div>
            `;

            return element;
        }

        // 格式化奖励文本
        function formatRewardText(reward) {
            if (!reward) return '';

            const rewardParts = [];
            const rewardNames = {
                money: '💰',
                reputation: '⭐',
                satisfaction: '😊',
                productivity: '📈'
            };

            for (const [type, amount] of Object.entries(reward)) {
                const icon = rewardNames[type] || type;
                rewardParts.push(`${icon}${amount}`);
            }

            return rewardParts.join(' ');
        }

        // 更新成就显示（在状态栏）
        function updateAchievementDisplay() {
            if (!window.game || !window.game.gameManager) return;

            const achievementSystem = window.game.gameManager.getAchievementSystem();
            if (!achievementSystem) return;

            const summary = achievementSystem.getAchievementSummary();

            // 更新状态栏中的成就计数
            const achievementCountElement = document.getElementById('achievementCount');
            const totalAchievementsElement = document.getElementById('totalAchievements');

            if (achievementCountElement) {
                achievementCountElement.textContent = summary.unlocked;
            }
            if (totalAchievementsElement) {
                totalAchievementsElement.textContent = summary.total;
            }
        }

        // 显示成就解锁动画
        function showAchievementUnlockAnimation(achievement) {
            const overlay = document.getElementById('achievementUnlockOverlay');
            const nameElement = document.getElementById('unlockedAchievementName');
            const descriptionElement = document.getElementById('unlockedAchievementDescription');
            const rewardElement = document.getElementById('unlockedAchievementReward');

            if (overlay && nameElement && descriptionElement && rewardElement) {
                nameElement.textContent = achievement.name;
                descriptionElement.textContent = achievement.description;
                rewardElement.textContent = '奖励: ' + formatRewardText(achievement.reward);

                overlay.style.display = 'flex';

                // 3秒后自动关闭
                setTimeout(() => {
                    overlay.style.display = 'none';
                }, 3000);

                // 点击关闭
                overlay.onclick = () => {
                    overlay.style.display = 'none';
                };
            }
        }

        // 调试插件系统
        function debugPlugins() {
            console.log('=== 插件系统调试信息 ===');
            console.log('游戏对象:', window.game);
            console.log('插件数量:', window.game ? window.game.plugins.size : '游戏未加载');

            if (window.game && window.game.plugins.size > 0) {
                console.log('已注册的插件:');
                window.game.plugins.forEach((plugin, name) => {
                    console.log(`  - ${name}: ${plugin.isActive ? '已激活' : '未激活'}`);
                });
            } else {
                console.log('没有找到已注册的插件');
            }

            // 测试插件注册
            if (window.game && window.game.plugins.size === 0) {
                console.log('尝试手动注册插件...');
                try {
                    const acPlugin = new AirConditioningPlugin();
                    window.game.registerPlugin(acPlugin);
                    console.log('✅ 空调插件手动注册成功');
                } catch (error) {
                    console.error('❌ 插件注册失败:', error);
                }
            }
        }

        // 进展UI相关函数
        let currentProgressionTab = 'overview';

        // 初始化进展UI
        function initializeProgressionUI() {
            // 显示进展统计
            const levelStat = document.getElementById('level-stat');
            const experienceStat = document.getElementById('experience-stat');

            if (levelStat) levelStat.style.display = 'block';
            if (experienceStat) experienceStat.style.display = 'block';

            // 定期更新进展显示
            setInterval(updateProgressionDisplay, 1000);

            // 监听等级提升事件
            setupLevelUpListener();
        }

        // 切换进展面板显示
        function toggleProgressionPanel() {
            const panel = document.getElementById('progressionPanel');
            if (panel.style.display === 'none' || !panel.style.display) {
                panel.style.display = 'flex';
                updateProgressionPanel();
            } else {
                panel.style.display = 'none';
            }
        }

        // 显示进展标签页
        function showProgressionTab(tabName) {
            currentProgressionTab = tabName;

            // 更新标签页样式
            document.querySelectorAll('.progression-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // 隐藏所有内容
            document.querySelectorAll('.progression-tab-content').forEach(content => {
                content.style.display = 'none';
            });

            // 显示选中的内容
            const targetContent = document.getElementById(`progression${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`);
            if (targetContent) {
                targetContent.style.display = 'block';
            }

            // 更新对应内容
            switch (tabName) {
                case 'overview':
                    updateProgressionOverview();
                    break;
                case 'unlocks':
                    updateUnlockPreview();
                    break;
                case 'milestones':
                    updateMilestoneProgress();
                    break;
                case 'floors':
                    updateFloorManagement();
                    break;
            }
        }

        // 更新进展面板
        function updateProgressionPanel() {
            if (!window.game || !window.game.gameManager) return;

            const progressionSystem = window.game.gameManager.getProgressionSystem();
            if (!progressionSystem) return;

            const summary = progressionSystem.getProgressSummary();

            // 更新统计信息
            document.getElementById('progressionCurrentLevel').textContent = summary.level;
            document.getElementById('progressionEmployeeCapacity').textContent = summary.employeeCapacity;
            document.getElementById('progressionUnlockedFeatures').textContent = summary.unlockedFeatures.length;
            document.getElementById('progressionFloors').textContent = summary.maxFloors;

            // 更新当前标签页内容
            switch (currentProgressionTab) {
                case 'overview':
                    updateProgressionOverview();
                    break;
                case 'unlocks':
                    updateUnlockPreview();
                    break;
                case 'milestones':
                    updateMilestoneProgress();
                    break;
                case 'floors':
                    updateFloorManagement();
                    break;
            }
        }

        // 更新进展概览
        function updateProgressionOverview() {
            if (!window.game || !window.game.gameManager) return;

            const progressionSystem = window.game.gameManager.getProgressionSystem();
            if (!progressionSystem) return;

            const levelProgress = progressionSystem.getLevelProgress();

            // 更新等级显示
            document.getElementById('currentLevelDisplay').textContent = levelProgress.level;
            document.getElementById('currentExperience').textContent = levelProgress.experience;
            document.getElementById('experienceRequired').textContent = levelProgress.experienceToNext;
            document.getElementById('experienceRemaining').textContent = levelProgress.experienceToNext - levelProgress.experience;

            // 更新进度条
            const progressFill = document.getElementById('levelProgressFill');
            const progressText = document.getElementById('levelProgressText');
            if (progressFill && progressText) {
                const progressPercent = Math.floor(levelProgress.progress);
                progressFill.style.width = progressPercent + '%';
                progressText.textContent = progressPercent + '%';
            }

            // 更新下一级解锁内容
            updateNextLevelUnlocks();
        }

        // 更新下一级解锁内容
        function updateNextLevelUnlocks() {
            if (!window.game || !window.game.gameManager) return;

            const progressionSystem = window.game.gameManager.getProgressionSystem();
            if (!progressionSystem) return;

            const nextLevel = progressionSystem.companyLevel + 1;
            const unlockPreview = progressionSystem.getLevelUnlockPreview(nextLevel);
            const container = document.getElementById('nextLevelUnlocks');

            if (!container) return;

            container.innerHTML = '';

            if (unlockPreview.unlockDetails && unlockPreview.unlockDetails.length > 0) {
                unlockPreview.unlockDetails.forEach(unlock => {
                    const unlockElement = createUnlockElement(unlock, nextLevel, false);
                    container.appendChild(unlockElement);
                });
            } else {
                container.innerHTML = '<div style="text-align: center; color: #6c757d; padding: 20px;">下一级暂无新解锁内容</div>';
            }
        }

        // 更新解锁预览
        function updateUnlockPreview() {
            if (!window.game || !window.game.gameManager) return;

            const progressionSystem = window.game.gameManager.getProgressionSystem();
            if (!progressionSystem) return;

            const upcomingUnlocks = progressionSystem.getUpcomingUnlocks(5);
            const container = document.getElementById('futureUnlocks');

            if (!container) return;

            container.innerHTML = '';

            upcomingUnlocks.forEach(levelUnlock => {
                if (levelUnlock.unlockDetails && levelUnlock.unlockDetails.length > 0) {
                    // 添加等级标题
                    const levelHeader = document.createElement('div');
                    levelHeader.style.cssText = 'font-size: 1.1rem; font-weight: 600; color: #28a745; margin: 15px 0 10px 0; border-bottom: 1px solid #e9ecef; padding-bottom: 5px;';
                    levelHeader.textContent = `等级 ${levelUnlock.level}`;
                    container.appendChild(levelHeader);

                    levelUnlock.unlockDetails.forEach(unlock => {
                        const unlockElement = createUnlockElement(unlock, levelUnlock.level, true);
                        container.appendChild(unlockElement);
                    });
                }
            });

            if (container.children.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #6c757d; padding: 20px;">暂无更多解锁内容</div>';
            }
        }

        // 创建解锁元素
        function createUnlockElement(unlock, level, isLocked) {
            const element = document.createElement('div');
            element.className = `unlock-item ${isLocked ? 'locked' : ''}`;

            const categoryIcons = {
                'management': '👥',
                'analytics': '📊',
                'employee': '👤',
                'facility': '🏢',
                'expansion': '🏗️',
                'business': '💼',
                'technology': '⚡',
                'luxury': '💎',
                'achievement': '🏆',
                'basic': '🔧',
                'automation': '🤖'
            };

            const icon = categoryIcons[unlock.category] || '🔓';

            element.innerHTML = `
                <div class="unlock-icon">${icon}</div>
                <div class="unlock-info">
                    <div class="unlock-name">${unlock.name}</div>
                    <div class="unlock-description">${unlock.description}</div>
                </div>
                <div class="unlock-level ${isLocked ? 'locked' : ''}">等级 ${level}</div>
            `;

            return element;
        }

        // 更新里程碑进度
        function updateMilestoneProgress() {
            if (!window.game || !window.game.gameManager) return;

            const progressionSystem = window.game.gameManager.getProgressionSystem();
            if (!progressionSystem) return;

            const milestones = progressionSystem.getMilestoneProgress();
            const container = document.getElementById('milestoneList');

            if (!container) return;

            container.innerHTML = '';

            milestones.forEach(milestone => {
                const milestoneElement = createMilestoneElement(milestone);
                container.appendChild(milestoneElement);
            });

            if (milestones.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #6c757d; padding: 20px;">暂无里程碑</div>';
            }
        }

        // 创建里程碑元素
        function createMilestoneElement(milestone) {
            const element = document.createElement('div');
            const isCompleted = milestone.completed;
            const isInProgress = !isCompleted && milestone.progress > 0;

            element.className = `milestone-item ${isCompleted ? 'completed' : isInProgress ? 'in-progress' : ''}`;

            const categoryIcons = {
                'employees': '👥',
                'financial': '💰',
                'reputation': '⭐',
                'satisfaction': '😊',
                'time': '⏰'
            };

            const icon = categoryIcons[milestone.category] || '🏁';
            const progress = Math.floor(milestone.progress);
            const progressText = isCompleted ? '已完成' : `${progress}%`;

            // 格式化奖励文本
            const rewardText = formatMilestoneReward(milestone.rewards);

            element.innerHTML = `
                <div class="milestone-icon ${isCompleted ? 'completed' : ''}">${icon}</div>
                <div class="milestone-info">
                    <div class="milestone-name">${milestone.name}</div>
                    <div class="milestone-description">${milestone.description}</div>
                    <div class="milestone-progress">
                        <div class="milestone-progress-bar">
                            <div class="milestone-progress-fill" style="width: ${progress}%"></div>
                        </div>
                        <div class="milestone-progress-text">${progressText}</div>
                    </div>
                    ${rewardText ? `<div class="milestone-reward">奖励: ${rewardText}</div>` : ''}
                </div>
            `;

            return element;
        }

        // 格式化里程碑奖励文本
        function formatMilestoneReward(rewards) {
            if (!rewards) return '';

            const rewardParts = [];
            const rewardNames = {
                money: '💰',
                reputation: '⭐',
                satisfaction: '😊',
                productivity: '📈',
                experience: '⭐'
            };

            for (const [type, amount] of Object.entries(rewards)) {
                if (type === 'features' || type === 'floors') continue;
                const icon = rewardNames[type] || type;
                rewardParts.push(`${icon}${amount}`);
            }

            if (rewards.features && rewards.features.length > 0) {
                rewardParts.push(`🔓${rewards.features.length}项功能`);
            }

            if (rewards.floors) {
                rewardParts.push(`🏢${rewards.floors}层楼`);
            }

            return rewardParts.join(' ');
        }

        // 更新楼层管理
        function updateFloorManagement() {
            if (!window.game || !window.game.gameManager) return;

            const progressionSystem = window.game.gameManager.getProgressionSystem();
            if (!progressionSystem) return;

            const floors = progressionSystem.getAllFloors();
            const container = document.getElementById('floorList');

            if (!container) return;

            container.innerHTML = '';

            floors.forEach(floor => {
                const floorElement = createFloorElement(floor);
                container.appendChild(floorElement);
            });

            if (floors.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #6c757d; padding: 20px;">暂无楼层信息</div>';
            }
        }

        // 创建楼层元素
        function createFloorElement(floor) {
            const element = document.createElement('div');
            element.className = `milestone-item ${floor.unlocked ? 'completed' : ''}`;

            const occupancyRate = floor.capacity > 0 ? Math.floor((floor.currentEmployees / floor.capacity) * 100) : 0;
            const statusColor = occupancyRate > 80 ? '#dc3545' : occupancyRate > 60 ? '#ffc107' : '#28a745';

            element.innerHTML = `
                <div class="milestone-icon ${floor.unlocked ? 'completed' : ''}">🏢</div>
                <div class="milestone-info">
                    <div class="milestone-name">${floor.name}</div>
                    <div class="milestone-description">${floor.description}</div>
                    <div class="milestone-progress">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <span style="font-size: 0.8rem; color: #6c757d;">员工占用率</span>
                            <span style="font-size: 0.8rem; color: ${statusColor}; font-weight: 600;">
                                ${floor.currentEmployees}/${floor.capacity} (${occupancyRate}%)
                            </span>
                        </div>
                        <div class="milestone-progress-bar">
                            <div class="milestone-progress-fill" style="width: ${occupancyRate}%; background: ${statusColor};"></div>
                        </div>
                    </div>
                    ${floor.maintenanceCost > 0 ? `<div class="milestone-reward">维护成本: 💰${floor.maintenanceCost}/5分钟</div>` : ''}
                </div>
            `;

            return element;
        }

        // 更新进展显示（在状态栏）
        function updateProgressionDisplay() {
            if (!window.game || !window.game.gameManager) return;

            const progressionSystem = window.game.gameManager.getProgressionSystem();
            if (!progressionSystem) return;

            const levelProgress = progressionSystem.getLevelProgress();

            // 更新状态栏中的等级和经验
            const levelElement = document.getElementById('companyLevel');
            const experienceElement = document.getElementById('experiencePoints');
            const experienceToNextElement = document.getElementById('experienceToNext');

            if (levelElement) {
                levelElement.textContent = levelProgress.level;
            }
            if (experienceElement) {
                experienceElement.textContent = levelProgress.experience;
            }
            if (experienceToNextElement) {
                experienceToNextElement.textContent = levelProgress.experienceToNext;
            }
        }

        // 设置等级提升监听器
        function setupLevelUpListener() {
            // 监听等级变化
            let lastLevel = 1;

            setInterval(() => {
                if (!window.game || !window.game.gameManager) return;

                const progressionSystem = window.game.gameManager.getProgressionSystem();
                if (!progressionSystem) return;

                const currentLevel = progressionSystem.companyLevel;
                if (currentLevel > lastLevel) {
                    // 等级提升了，显示庆祝动画
                    showLevelUpAnimation(currentLevel, lastLevel);
                    lastLevel = currentLevel;
                }
            }, 1000);
        }

        // 显示等级提升庆祝动画
        function showLevelUpAnimation(newLevel, oldLevel) {
            if (!window.game || !window.game.gameManager) return;

            const progressionSystem = window.game.gameManager.getProgressionSystem();
            if (!progressionSystem) return;

            const overlay = document.getElementById('levelUpOverlay');
            const levelElement = document.getElementById('levelUpNewLevel');
            const rewardsElement = document.getElementById('levelUpRewards');
            const unlocksElement = document.getElementById('levelUpUnlocks');

            if (!overlay || !levelElement || !rewardsElement || !unlocksElement) return;

            // 获取等级奖励信息
            const levelRewards = progressionSystem.getLevelRewards(newLevel);
            const unlockPreview = progressionSystem.getLevelUnlockPreview(newLevel);

            // 设置动画内容
            levelElement.textContent = newLevel;

            // 格式化奖励文本
            const rewardParts = [];
            if (levelRewards.money) rewardParts.push(`💰 +${levelRewards.money.toLocaleString()}元`);
            if (levelRewards.reputation) rewardParts.push(`⭐ +${levelRewards.reputation}声望`);
            if (levelRewards.satisfaction) rewardParts.push(`😊 +${levelRewards.satisfaction}满意度`);
            if (levelRewards.productivity) rewardParts.push(`📈 +${levelRewards.productivity}生产力`);

            rewardsElement.innerHTML = rewardParts.join('<br>');

            // 格式化解锁内容
            const unlockParts = [];
            if (unlockPreview.unlockDetails && unlockPreview.unlockDetails.length > 0) {
                unlockPreview.unlockDetails.forEach(unlock => {
                    unlockParts.push(`🔓 ${unlock.name}`);
                });
            }

            if (unlockParts.length > 0) {
                unlocksElement.innerHTML = '新解锁:<br>' + unlockParts.join('<br>');
            } else {
                unlocksElement.innerHTML = '继续努力，更多功能等待解锁！';
            }

            // 显示动画
            overlay.style.display = 'flex';

            // 播放庆祝音效（如果有的话）
            console.log(`🎉 恭喜！公司等级从 ${oldLevel} 提升到 ${newLevel}！`);
        }

        // 关闭等级提升动画
        function closeLevelUpAnimation() {
            const overlay = document.getElementById('levelUpOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
        }

        // ===== 成就UI系统 =====

        // 初始化成就UI
        function initializeAchievementUI() {
            // 定期更新成就数据
            setInterval(updateAchievementStats, 2000);
        }

        // 更新成就统计
        function updateAchievementStats() {
            if (!window.game || !window.game.gameManager) return;

            const achievementSystem = window.game.gameManager.getAchievementSystem();
            if (!achievementSystem) return;

            const summary = achievementSystem.getAchievementSummary();

            // 更新顶部统计栏
            const achievementCountElement = document.getElementById('achievementCount');
            const totalAchievementsElement = document.getElementById('totalAchievements');

            if (achievementCountElement) {
                achievementCountElement.textContent = summary.unlocked;
            }

            if (totalAchievementsElement) {
                totalAchievementsElement.textContent = summary.total;
            }

            // 更新成就面板统计
            updateAchievementPanelStats(summary);
        }

        // 更新成就面板统计
        function updateAchievementPanelStats(summary) {
            const completionRateElement = document.getElementById('achievementCompletionRate');
            const unlockedElement = document.getElementById('achievementUnlocked');
            const totalElement = document.getElementById('achievementTotal');

            if (completionRateElement) {
                completionRateElement.textContent = `${summary.completionRate}%`;
            }

            if (unlockedElement) {
                unlockedElement.textContent = summary.unlocked;
            }

            if (totalElement) {
                totalElement.textContent = summary.total;
            }
        }

        // 切换成就面板显示/隐藏
        function toggleAchievementPanel() {
            const panel = document.getElementById('achievementPanel');
            if (!panel) return;

            if (panel.style.display === 'none' || panel.style.display === '') {
                panel.style.display = 'flex';
                updateAchievementPanel();
            } else {
                panel.style.display = 'none';
            }
        }

        // 更新成就面板
        function updateAchievementPanel() {
            if (!window.game || !window.game.gameManager) return;

            const achievementSystem = window.game.gameManager.getAchievementSystem();
            if (!achievementSystem) return;

            const summary = achievementSystem.getAchievementSummary();
            updateAchievementPanelStats(summary);

            // 默认显示所有成就
            showAchievementTab('all');
        }

        // 显示成就标签页
        function showAchievementTab(tabName) {
            if (!window.game || !window.game.gameManager) return;

            const achievementSystem = window.game.gameManager.getAchievementSystem();
            if (!achievementSystem) return;

            // 移除所有标签页的激活状态
            const tabs = document.querySelectorAll('.achievement-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // 激活选中的标签页
            const selectedTab = document.querySelector(`.achievement-tab[onclick="showAchievementTab('${tabName}')"]`);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }

            // 获取成就数据
            let achievements = [];
            const allAchievements = achievementSystem.getAllAchievements();

            switch (tabName) {
                case 'all':
                    achievements = allAchievements;
                    break;
                case 'unlocked':
                    achievements = allAchievements.filter(a => a.unlocked);
                    break;
                case 'locked':
                    achievements = allAchievements.filter(a => !a.unlocked);
                    break;
                case 'recent':
                    achievements = achievementSystem.getUnlockedAchievements()
                        .sort((a, b) => (b.unlockedAt || 0) - (a.unlockedAt || 0))
                        .slice(0, 10);
                    break;
            }

            // 更新成就列表
            updateAchievementList(achievements);
        }

        // 更新成就列表
        function updateAchievementList(achievements) {
            const listContainer = document.getElementById('achievementList');
            if (!listContainer) return;

            listContainer.innerHTML = '';

            if (achievements.length === 0) {
                listContainer.innerHTML = `
                    <div class="achievement-item">
                        <div class="achievement-icon">🎯</div>
                        <div class="achievement-info">
                            <div class="achievement-name">暂无成就</div>
                            <div class="achievement-description">继续游戏以解锁成就</div>
                        </div>
                    </div>
                `;
                return;
            }

            achievements.forEach(achievement => {
                const achievementItem = document.createElement('div');
                achievementItem.className = `achievement-item ${achievement.unlocked ? 'unlocked' : ''}`;

                const progressPercent = Math.floor(achievement.progress || 0);
                const rewardText = formatAchievementRewards(achievement.reward);

                achievementItem.innerHTML = `
                    <div class="achievement-icon">${achievement.icon || '🏆'}</div>
                    <div class="achievement-info">
                        <div class="achievement-name">${achievement.name}</div>
                        <div class="achievement-description">${achievement.description}</div>
                        ${!achievement.unlocked ? `
                            <div class="achievement-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${progressPercent}%"></div>
                                </div>
                                <div class="progress-text">${progressPercent}%</div>
                            </div>
                        ` : ''}
                        ${rewardText ? `<div class="achievement-reward">奖励: ${rewardText}</div>` : ''}
                    </div>
                `;

                listContainer.appendChild(achievementItem);
            });
        }

        // 格式化成就奖励
        function formatAchievementRewards(reward) {
            if (!reward) return '';

            const rewardParts = [];
            const resourceIcons = {
                money: '💰',
                reputation: '⭐',
                satisfaction: '😊',
                productivity: '📈'
            };

            for (const [resource, amount] of Object.entries(reward)) {
                const icon = resourceIcons[resource] || resource;
                rewardParts.push(`${icon}${amount}`);
            }

            return rewardParts.join(' ');
        }

        // 成就解锁动画
        window.showAchievementUnlockAnimation = function (achievement) {
            console.log(`🏆 成就解锁动画: ${achievement.name}`);

            const overlay = document.getElementById('achievementUnlockOverlay');
            const nameElement = document.getElementById('unlockedAchievementName');
            const descriptionElement = document.getElementById('unlockedAchievementDescription');
            const rewardElement = document.getElementById('unlockedAchievementReward');

            if (!overlay) return;

            // 设置成就信息
            if (nameElement) {
                nameElement.textContent = achievement.name;
            }

            if (descriptionElement) {
                descriptionElement.textContent = achievement.description;
            }

            if (rewardElement && achievement.reward) {
                const rewardText = formatAchievementRewards(achievement.reward);
                rewardElement.textContent = `奖励: ${rewardText}`;
            }

            // 显示动画
            overlay.style.display = 'flex';

            // 3秒后自动关闭
            setTimeout(() => {
                overlay.style.display = 'none';
            }, 3000);

            // 点击关闭
            overlay.onclick = () => {
                overlay.style.display = 'none';
            };
        };

        // ===== 游戏控制函数 =====

        // 游戏变量
        // 游戏初始化已在 game.js 中处理
        // 这里的函数使用 window.game 访问全局游戏实例

        // 更新员工数量显示
        function updateEmployeeCount() {
            const countElement = document.getElementById('employeeCount');
            if (countElement && window.game) {
                countElement.textContent = window.game.employees.length;
            }
        }

        // 更新游戏时间显示
        function updateGameTime() {
            const timeElement = document.getElementById('gameTime');
            if (timeElement && window.game) {
                const minutes = Math.floor(window.game.gameTime / 60);
                const seconds = Math.floor(window.game.gameTime % 60);
                timeElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        // 调试插件
        function debugPlugins() {
            if (!window.game) {
                console.log('❌ 游戏未初始化');
                return;
            }

            console.log('🔧 插件调试信息:');
            console.log('可用插件:', window.game.getPluginList());
            console.log('已实施解决方案:', window.game.getSolutions());

            if (window.game.gameManager) {
                console.log('增强功能状态:', window.game.gameManager.getGameSummary());
            }
        }

        // 测试增强功能
        function testEnhancedFeatures() {
            if (!window.game || !window.game.gameManager) {
                console.log('❌ 增强功能未初始化');
                return;
            }

            console.log('🎮 测试增强功能...');

            // 测试资源系统
            const resourceSystem = window.game.gameManager.getResourceSystem();
            if (resourceSystem) {
                console.log('💰 当前资源:', resourceSystem.getResourceSummary());
                resourceSystem.addResource('money', 10000);
                resourceSystem.addResource('satisfaction', 10);
                console.log('✅ 资源系统测试完成');
            }

            // 测试成就系统
            const achievementSystem = game.gameManager.getAchievementSystem();
            if (achievementSystem) {
                console.log('🏆 成就摘要:', achievementSystem.getAchievementSummary());
                console.log('✅ 成就系统测试完成');
            }

            // 测试进展系统
            const progressionSystem = game.gameManager.getProgressionSystem();
            if (progressionSystem) {
                console.log('📈 进展摘要:', progressionSystem.getProgressSummary());
                progressionSystem.addExperience(500, '测试');
                console.log('✅ 进展系统测试完成');
            }

            console.log('🎉 增强功能测试完成！');
        }





        // 游戏初始化已在 game.js 中通过 window.addEventListener('load', ...) 处理

        // 全局函数导出
        window.updateEmployeeCount = updateEmployeeCount;
        window.updateGameTime = updateGameTime;

        // 全局等级提升动画函数（供GameManager调用）
        window.showLevelUpAnimation = showLevelUpAnimation;

        // 全局插件管理函数
        window.togglePlugin = togglePlugin;
        window.adjustTemperature = adjustTemperature;
        window.emergencyRepair = emergencyRepair;

        // ===== 统计面板函数 =====

        // 切换统计面板显示/隐藏
        function toggleStatisticsPanel() {
            const panel = document.getElementById('statisticsPanel');
            if (!panel) return;

            if (panel.style.display === 'none' || panel.style.display === '') {
                panel.style.display = 'flex';
                updateStatisticsPanel();
            } else {
                panel.style.display = 'none';
            }
        }

        // 显示统计标签页
        function showStatisticsTab(tabName) {
            // 移除所有标签页的激活状态
            const tabs = document.querySelectorAll('.statistics-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // 隐藏所有内容
            const contents = document.querySelectorAll('.statistics-tab-content');
            contents.forEach(content => {
                content.style.display = 'none';
            });

            // 激活选中的标签页
            const selectedTab = document.querySelector(`.statistics-tab[onclick="showStatisticsTab('${tabName}')"]`);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }

            // 显示对应内容
            const content = document.getElementById(`statistics${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`);
            if (content) {
                content.style.display = 'block';
            }

            // 根据标签页更新内容
            switch (tabName) {
                case 'overview':
                    updateOverviewTab();
                    break;
                case 'trends':
                    updateTrendsTab();
                    break;
                case 'performance':
                    updatePerformanceTab();
                    break;
                case 'suggestions':
                    updateSuggestionsTab();
                    break;
                case 'export':
                    updateExportTab();
                    break;
            }
        }

        // 更新统计面板
        function updateStatisticsPanel() {
            if (!window.game || !window.game.gameManager) {
                console.warn('统计系统未初始化');
                return;
            }

            const statisticsSystem = window.game.gameManager.getStatisticsSystem();
            if (!statisticsSystem) {
                console.warn('统计系统不可用');
                return;
            }

            // 默认显示概览标签页
            showStatisticsTab('overview');
        }

        // 更新概览标签页
        function updateOverviewTab() {
            if (!window.game || !window.game.gameManager) return;

            const resourceSystem = window.game.gameManager.getResourceSystem();
            const statisticsSystem = window.game.gameManager.getStatisticsSystem();

            if (!resourceSystem || !statisticsSystem) return;

            const summary = statisticsSystem.getStatisticsSummary();

            // 更新统计卡片
            updateStatCard('statCurrentMoney', summary.current.money, '元');
            updateStatCard('statEmployeeCount', summary.current.employees, '人');
            updateStatCard('statSatisfaction', summary.current.satisfaction, '%');
            updateStatCard('statProductivity', summary.current.productivity, '%');
            updateStatCard('statReputation', summary.current.reputation, '');
            updateStatCard('statDailyIncome', resourceSystem.calculateIncome(), '元/日');

            // 更新变化指示器
            updateChangeIndicators(summary);
        }

        // 更新趋势标签页
        function updateTrendsTab() {
            if (!window.game || !window.game.gameManager) return;

            const statisticsSystem = window.game.gameManager.getStatisticsSystem();
            if (!statisticsSystem) return;

            const summary = statisticsSystem.getStatisticsSummary();
            const trends = summary.trends;

            // 更新趋势指示器
            updateTrendIndicator('trendSatisfaction', trends.satisfaction);
            updateTrendIndicator('trendProductivity', trends.productivity);
            updateTrendIndicator('trendReputation', trends.reputation);
            updateTrendIndicator('trendMoney', trends.money);
            updateTrendIndicator('trendEmployees', trends.employees);

            // 更新趋势分析报告
            updateTrendAnalysisReport(trends);
        }

        // 更新性能标签页
        function updatePerformanceTab() {
            if (!window.game || !window.game.gameManager) return;

            const statisticsSystem = window.game.gameManager.getStatisticsSystem();
            if (!statisticsSystem) return;

            const summary = statisticsSystem.getStatisticsSummary();
            const performance = summary.performance;

            // 更新性能指标
            updateStatCard('statEfficiency', performance.efficiency, '%');
            updateStatCard('statGrowthRate', performance.growthRate, '%');
            updateStatCard('statRetentionRate', performance.retentionRate, '%');
            updateStatCard('statProfitability', performance.profitability, '%');

            // 更新KPI摘要
            updateKPISummary(performance);
        }

        // 更新建议标签页
        function updateSuggestionsTab() {
            if (!window.game || !window.game.gameManager) return;

            const statisticsSystem = window.game.gameManager.getStatisticsSystem();
            if (!statisticsSystem) return;

            const summary = statisticsSystem.getStatisticsSummary();

            // 更新自动建议按钮状态
            const autoButton = document.getElementById('autoSuggestionsToggle');
            if (autoButton) {
                autoButton.textContent = statisticsSystem.autoSuggestionsEnabled ? '禁用自动建议' : '启用自动建议';
                autoButton.style.background = statisticsSystem.autoSuggestionsEnabled ? '#dc3545' : '#28a745';
            }

            // 更新建议列表
            updateSuggestionsList(summary.suggestions);

            // 更新预警列表
            updateAlertsList(summary.alerts);

            // 更新建议执行历史
            updateSuggestionExecutionHistory();

            // 更新建议执行统计
            updateSuggestionExecutionStats();
        }

        // 更新导出标签页
        function updateExportTab() {
            if (!window.game || !window.game.gameManager) return;

            const statisticsSystem = window.game.gameManager.getStatisticsSystem();
            if (!statisticsSystem) return;

            const summary = statisticsSystem.getStatisticsSummary();

            // 更新数据收集状态
            updateDataCollectionStatus(summary.dataPoints);
        }

        // 辅助函数：更新统计卡片
        function updateStatCard(elementId, value, unit) {
            const element = document.getElementById(elementId);
            if (element) {
                if (typeof value === 'number') {
                    if (unit === '元' || unit === '元/日') {
                        element.textContent = value.toLocaleString() + unit;
                    } else {
                        element.textContent = Math.round(value * 100) / 100 + unit;
                    }
                } else {
                    element.textContent = value + unit;
                }
            }
        }

        // 辅助函数：更新变化指示器
        function updateChangeIndicators(summary) {
            // 这里可以添加变化指示器的逻辑
            // 暂时显示为无变化
            const changeElements = [
                'statMoneyChange', 'statEmployeeChange', 'statSatisfactionChange',
                'statProductivityChange', 'statReputationChange', 'statIncomeChange'
            ];

            changeElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = '无变化';
                    element.className = 'stat-card-change neutral';
                }
            });
        }

        // 辅助函数：更新趋势指示器
        function updateTrendIndicator(prefix, trend) {
            const iconElement = document.getElementById(prefix + 'Icon');
            const valueElement = document.getElementById(prefix + 'Value');

            if (iconElement && valueElement) {
                // 更新图标和样式
                iconElement.className = `trend-icon ${trend.direction}`;

                switch (trend.direction) {
                    case 'increasing':
                        iconElement.textContent = '📈';
                        valueElement.textContent = `上升 (${Math.round(trend.strength)}%)`;
                        break;
                    case 'decreasing':
                        iconElement.textContent = '📉';
                        valueElement.textContent = `下降 (${Math.round(trend.strength)}%)`;
                        break;
                    default:
                        iconElement.textContent = '➡️';
                        valueElement.textContent = '稳定';
                }
            }
        }

        // 辅助函数：更新趋势分析报告
        function updateTrendAnalysisReport(trends) {
            const reportElement = document.getElementById('trendAnalysisReport');
            if (!reportElement) return;

            let report = '<div style="line-height: 1.6;">';

            // 分析各项趋势
            Object.entries(trends).forEach(([metric, trend]) => {
                const metricNames = {
                    satisfaction: '员工满意度',
                    productivity: '生产力',
                    reputation: '公司声望',
                    money: '资金状况',
                    employees: '员工规模'
                };

                const metricName = metricNames[metric] || metric;
                let analysis = '';

                if (trend.direction === 'increasing') {
                    analysis = `<span style="color: #28a745;">呈上升趋势</span>，强度 ${Math.round(trend.strength)}%`;
                } else if (trend.direction === 'decreasing') {
                    analysis = `<span style="color: #dc3545;">呈下降趋势</span>，强度 ${Math.round(trend.strength)}%`;
                } else {
                    analysis = '<span style="color: #6c757d;">保持稳定</span>';
                }

                report += `<p><strong>${metricName}:</strong> ${analysis}</p>`;
            });

            report += '</div>';
            reportElement.innerHTML = report;
        }

        // 辅助函数：更新KPI摘要
        function updateKPISummary(performance) {
            const kpiElement = document.getElementById('kpiSummary');
            if (!kpiElement) return;

            const kpi = `
                <div style="line-height: 1.8;">
                    <p><strong>运营效率:</strong> ${Math.round(performance.efficiency)}% 
                       ${performance.efficiency >= 70 ? '<span style="color: #28a745;">优秀</span>' :
                    performance.efficiency >= 50 ? '<span style="color: #ffc107;">良好</span>' :
                        '<span style="color: #dc3545;">需改进</span>'}</p>
                    <p><strong>增长速度:</strong> ${Math.round(performance.growthRate)}% 
                       ${performance.growthRate > 0 ? '<span style="color: #28a745;">正增长</span>' :
                    performance.growthRate < 0 ? '<span style="color: #dc3545;">负增长</span>' :
                        '<span style="color: #6c757d;">无增长</span>'}</p>
                    <p><strong>员工留存:</strong> ${Math.round(performance.retentionRate)}% 
                       ${performance.retentionRate >= 80 ? '<span style="color: #28a745;">优秀</span>' :
                    performance.retentionRate >= 60 ? '<span style="color: #ffc107;">良好</span>' :
                        '<span style="color: #dc3545;">需关注</span>'}</p>
                    <p><strong>盈利能力:</strong> ${Math.round(performance.profitability)}% 
                       ${performance.profitability > 0 ? '<span style="color: #28a745;">盈利</span>' :
                    '<span style="color: #dc3545;">亏损</span>'}</p>
                </div>
            `;
            kpiElement.innerHTML = kpi;
        }

        // 更新建议执行历史
        function updateSuggestionExecutionHistory() {
            if (!window.game || !window.game.gameManager) return;

            const statisticsSystem = window.game.gameManager.getStatisticsSystem();
            if (!statisticsSystem || !statisticsSystem.suggestionHistory) return;

            const historyElement = document.getElementById('suggestionExecutionHistory');
            if (!historyElement) return;

            const history = statisticsSystem.suggestionHistory.slice(-10); // 最近10条

            if (history.length === 0) {
                historyElement.innerHTML = '<p>暂无建议执行记录</p>';
                return;
            }

            let html = '';
            history.forEach(suggestion => {
                const executedTime = new Date(suggestion.executedAt).toLocaleString();
                const costText = suggestion.estimatedCost ? `成本: ${suggestion.estimatedCost.toLocaleString()}元` : '无成本';

                html += `
                    <div style="background: #f8f9fa; padding: 10px; margin-bottom: 8px; border-radius: 6px; border-left: 3px solid #28a745;">
                        <div style="font-weight: 600; color: #333;">${suggestion.title}</div>
                        <div style="font-size: 0.85rem; color: #6c757d; margin-top: 3px;">
                            执行时间: ${executedTime} | ${costText}
                        </div>
                    </div>
                `;
            });

            historyElement.innerHTML = html;
        }

        // 更新建议执行统计
        function updateSuggestionExecutionStats() {
            if (!window.game || !window.game.gameManager) return;

            const statisticsSystem = window.game.gameManager.getStatisticsSystem();
            if (!statisticsSystem) return;

            const statsElement = document.getElementById('suggestionExecutionStats');
            if (!statsElement) return;

            const stats = statisticsSystem.getSuggestionExecutionStats();
            if (!stats) {
                statsElement.innerHTML = '<p>暂无统计数据</p>';
                return;
            }

            let html = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: #17a2b8;">${stats.totalExecuted}</div>
                        <div style="font-size: 0.9rem; color: #6c757d;">总执行数</div>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: #dc3545;">${stats.totalCostSpent.toLocaleString()}</div>
                        <div style="font-size: 0.9rem; color: #6c757d;">总投入成本</div>
                    </div>
                </div>
                
                <div style="margin-top: 15px;">
                    <h5>按类型统计:</h5>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
                        ${Object.entries(stats.byType).map(([type, count]) => `
                            <span style="background: #e9ecef; padding: 5px 10px; border-radius: 15px; font-size: 0.85rem;">
                                ${type}: ${count}
                            </span>
                        `).join('')}
                    </div>
                </div>
                
                <div style="margin-top: 15px;">
                    <h5>按优先级统计:</h5>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
                        ${Object.entries(stats.byPriority).map(([priority, count]) => `
                            <span style="background: ${priority === 'critical' ? '#f8d7da' : priority === 'high' ? '#fff3cd' : '#d1ecf1'}; 
                                         padding: 5px 10px; border-radius: 15px; font-size: 0.85rem;">
                                ${priority}: ${count}
                            </span>
                        `).join('')}
                    </div>
                </div>
            `;

            statsElement.innerHTML = html;
        }

        // 辅助函数：更新建议列表
        function updateSuggestionsList(suggestions) {
            const listElement = document.getElementById('suggestionsList');
            if (!listElement) return;

            if (!suggestions || suggestions.length === 0) {
                listElement.innerHTML = '<p>暂无改进建议</p>';
                return;
            }

            let html = '';
            suggestions.forEach((suggestion, index) => {
                const priorityClass = suggestion.priority === 'critical' ? 'high-priority' :
                    suggestion.priority === 'high' ? 'high-priority' :
                        suggestion.priority === 'medium' ? 'medium-priority' : '';

                const priorityIcon = suggestion.priority === 'critical' ? '🚨' :
                    suggestion.priority === 'high' ? '⚠️' :
                        suggestion.priority === 'medium' ? '💡' : 'ℹ️';

                const costText = suggestion.estimatedCost ?
                    `<div style="font-size: 0.8rem; color: #dc3545; margin-top: 5px;">
                        💰 预估成本: ${suggestion.estimatedCost.toLocaleString()}元
                    </div>` : '';

                const benefitText = suggestion.expectedBenefit ?
                    `<div style="font-size: 0.8rem; color: #28a745; margin-top: 3px;">
                        📈 预期收益: ${suggestion.expectedBenefit}
                    </div>` : '';

                html += `
                    <div class="suggestion-item ${priorityClass}" style="position: relative;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div style="flex: 1;">
                                <div class="suggestion-title">
                                    ${priorityIcon} ${suggestion.title}
                                </div>
                                <div class="suggestion-description">${suggestion.description}</div>
                                <div class="suggestion-actions">
                                    <strong>建议行动:</strong> ${suggestion.actions.join(', ')}
                                </div>
                                ${costText}
                                ${benefitText}
                            </div>
                            <div style="margin-left: 15px;">
                                <button class="export-btn" onclick="executeSuggestion(${index})" 
                                        style="background: #28a745; color: white; font-size: 0.8rem; padding: 6px 12px;">
                                    执行建议
                                </button>
                                <button class="export-btn" onclick="showSuggestionDetails(${index})" 
                                        style="background: #17a2b8; color: white; font-size: 0.8rem; padding: 6px 12px; margin-top: 5px;">
                                    查看详情
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });

            listElement.innerHTML = html;
        }

        // 辅助函数：更新预警列表
        function updateAlertsList(alerts) {
            const listElement = document.getElementById('alertsList');
            if (!listElement) return;

            if (!alerts || alerts.length === 0) {
                listElement.innerHTML = '<p>暂无预警信息</p>';
                return;
            }

            let html = '';
            alerts.forEach(alert => {
                const time = new Date(alert.timestamp).toLocaleTimeString();
                html += `
                    <div class="alert-item ${alert.severity}">
                        <span class="alert-timestamp">${time}</span>
                        ${alert.message}
                    </div>
                `;
            });

            listElement.innerHTML = html;
        }

        // 辅助函数：更新数据收集状态
        function updateDataCollectionStatus(dataPoints) {
            const statusElement = document.getElementById('dataCollectionStatus');
            if (!statusElement) return;

            const status = `
                <div style="line-height: 1.6;">
                    <p><strong>资源数据:</strong> ${dataPoints.resources} 个数据点</p>
                    <p><strong>员工数据:</strong> ${dataPoints.employees} 个数据点</p>
                    <p><strong>抱怨数据:</strong> ${dataPoints.complaints} 个数据点</p>
                    <p><strong>性能数据:</strong> ${dataPoints.performance} 个数据点</p>
                    <p style="color: #6c757d; font-size: 0.9rem; margin-top: 10px;">
                        数据每秒自动收集一次，用于趋势分析和智能建议
                    </p>
                </div>
            `;
            statusElement.innerHTML = status;
        }

        // 导出统计数据
        function exportStatisticsData(format) {
            if (!window.game || !window.game.gameManager) {
                alert('统计系统未初始化');
                return;
            }

            const statisticsSystem = window.game.gameManager.getStatisticsSystem();
            if (!statisticsSystem) {
                alert('统计系统不可用');
                return;
            }

            try {
                const data = statisticsSystem.exportData(format);
                const blob = new Blob([data], {
                    type: format === 'json' ? 'application/json' : 'text/csv'
                });

                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `office-game-statistics.${format}`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                alert(`统计数据已导出为 ${format.toUpperCase()} 格式`);
            } catch (error) {
                console.error('导出失败:', error);
                alert('导出失败，请稍后重试');
            }
        }

        // 清除统计数据
        function clearStatisticsData() {
            if (!confirm('确定要清除所有历史统计数据吗？此操作无法恢复！')) {
                return;
            }

            if (!window.game || !window.game.gameManager) {
                alert('统计系统未初始化');
                return;
            }

            const statisticsSystem = window.game.gameManager.getStatisticsSystem();
            if (!statisticsSystem) {
                alert('统计系统不可用');
                return;
            }

            try {
                statisticsSystem.clearHistoricalData();
                alert('历史统计数据已清除');

                // 刷新当前显示的数据
                updateStatisticsPanel();
            } catch (error) {
                console.error('清除数据失败:', error);
                alert('清除数据失败，请稍后重试');
            }
        }

        // 执行建议
        function executeSuggestion(suggestionIndex) {
            if (!window.game || !window.game.gameManager) {
                alert('统计系统未初始化');
                return;
            }

            const statisticsSystem = window.game.gameManager.getStatisticsSystem();
            if (!statisticsSystem) {
                alert('统计系统不可用');
                return;
            }

            const suggestions = statisticsSystem.suggestions;
            if (!suggestions || suggestionIndex >= suggestions.length) {
                alert('无效的建议');
                return;
            }

            const suggestion = suggestions[suggestionIndex];

            // 确认执行
            let confirmMessage = `确定要执行建议"${suggestion.title}"吗？`;
            if (suggestion.estimatedCost) {
                confirmMessage += `\n\n预估成本: ${suggestion.estimatedCost.toLocaleString()}元`;
            }
            if (suggestion.expectedBenefit) {
                confirmMessage += `\n预期收益: ${suggestion.expectedBenefit}`;
            }

            if (!confirm(confirmMessage)) {
                return;
            }

            // 执行建议
            const success = statisticsSystem.executeSuggestion(suggestionIndex);
            if (success) {
                // 刷新建议列表
                updateSuggestionsTab();
                // 刷新概览数据
                updateOverviewTab();
            }
        }

        // 显示建议详情
        function showSuggestionDetails(suggestionIndex) {
            if (!window.game || !window.game.gameManager) {
                alert('统计系统未初始化');
                return;
            }

            const statisticsSystem = window.game.gameManager.getStatisticsSystem();
            if (!statisticsSystem) {
                alert('统计系统不可用');
                return;
            }

            const suggestions = statisticsSystem.suggestions;
            if (!suggestions || suggestionIndex >= suggestions.length) {
                alert('无效的建议');
                return;
            }

            const suggestion = suggestions[suggestionIndex];
            const prediction = statisticsSystem.predictSuggestionImpact(suggestion);

            let detailsHTML = `
                <div style="max-width: 500px; line-height: 1.6;">
                    <h3>${suggestion.title}</h3>
                    <p><strong>描述:</strong> ${suggestion.description}</p>
                    <p><strong>优先级:</strong> ${suggestion.priority}</p>
                    <p><strong>类型:</strong> ${suggestion.type}</p>
                    
                    <h4>建议行动:</h4>
                    <ul>
                        ${suggestion.actions.map(action => `<li>${action}</li>`).join('')}
                    </ul>
                    
                    <h4>影响预测:</h4>
                    <p><strong>预期影响:</strong> ${suggestion.impact}</p>
                    <p><strong>成功概率:</strong> ${prediction.successProbability}%</p>
                    <p><strong>风险级别:</strong> ${prediction.riskLevel}</p>
                    <p><strong>生效时间:</strong> ${prediction.timeToEffect}</p>
                    
                    ${suggestion.estimatedCost ? `<p><strong>预估成本:</strong> ${suggestion.estimatedCost.toLocaleString()}元</p>` : ''}
                    ${suggestion.expectedBenefit ? `<p><strong>预期收益:</strong> ${suggestion.expectedBenefit}</p>` : ''}
                    
                    ${prediction.sideEffects.length > 0 ? `
                        <h4>可能的副作用:</h4>
                        <ul>
                            ${prediction.sideEffects.map(effect => `<li>${effect}</li>`).join('')}
                        </ul>
                    ` : ''}
                </div>
            `;

            // 创建模态对话框
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                z-index: 2000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;

            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                padding: 20px;
                border-radius: 10px;
                max-height: 80vh;
                overflow-y: auto;
                position: relative;
            `;

            const closeBtn = document.createElement('button');
            closeBtn.textContent = '✕';
            closeBtn.style.cssText = `
                position: absolute;
                top: 10px;
                right: 15px;
                background: none;
                border: none;
                font-size: 1.5rem;
                cursor: pointer;
            `;
            closeBtn.onclick = () => document.body.removeChild(modal);

            content.innerHTML = detailsHTML;
            content.appendChild(closeBtn);
            modal.appendChild(content);
            document.body.appendChild(modal);

            // 点击背景关闭
            modal.onclick = (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            };
        }

        // 切换自动建议系统
        function toggleAutoSuggestions() {
            if (!window.game || !window.game.gameManager) {
                alert('统计系统未初始化');
                return;
            }

            const statisticsSystem = window.game.gameManager.getStatisticsSystem();
            if (!statisticsSystem) {
                alert('统计系统不可用');
                return;
            }

            const currentState = statisticsSystem.autoSuggestionsEnabled;
            statisticsSystem.enableAutoSuggestions(!currentState);

            // 更新按钮文本
            const button = document.getElementById('autoSuggestionsToggle');
            if (button) {
                button.textContent = statisticsSystem.autoSuggestionsEnabled ? '禁用自动建议' : '启用自动建议';
                button.style.background = statisticsSystem.autoSuggestionsEnabled ? '#dc3545' : '#28a745';
            }
        }

        // 全局统计面板函数（供其他系统调用）
        window.toggleStatisticsPanel = toggleStatisticsPanel;
        window.updateStatisticsPanel = updateStatisticsPanel;
        window.executeSuggestion = executeSuggestion;
        window.showSuggestionDetails = showSuggestionDetails;
        window.toggleAutoSuggestions = toggleAutoSuggestions;

        // 全局成就和进展面板函数
        window.toggleAchievementPanel = toggleAchievementPanel;
        window.toggleProgressionPanel = toggleProgressionPanel;

        // 全局调试和测试函数
        window.debugPlugins = debugPlugins;
        window.testEnhancedFeatures = testEnhancedFeatures;

        // 全局标签页切换函数
        window.showAchievementTab = showAchievementTab;
        window.showProgressionTab = showProgressionTab;
        window.showStatisticsTab = showStatisticsTab;

        // 全局对话框函数
        window.closeLevelUpAnimation = closeLevelUpAnimation;
        window.closeEventDialog = closeEventDialog;
        window.closeEventResultDialog = closeEventResultDialog;
        window.closeEmployeeDetailsPanel = closeEmployeeDetailsPanel;

        // 全局数据导出函数
        window.exportStatisticsData = exportStatisticsData;
        window.clearStatisticsData = clearStatisticsData;

        // ==================== 社交分享系统 ====================

        // 社交分享面板
        function toggleSocialPanel() {
            let panel = document.getElementById('socialPanel');

            if (panel) {
                document.body.removeChild(panel);
                return;
            }

            if (!window.game || !window.game.gameManager) {
                alert('游戏系统未初始化');
                return;
            }

            const leaderboardSystem = window.game.gameManager.getLeaderboardSystem();
            if (!leaderboardSystem) {
                alert('排行榜系统不可用');
                return;
            }

            panel = document.createElement('div');
            panel.id = 'socialPanel';
            panel.className = 'social-panel';

            const summary = leaderboardSystem.getLeaderboardSummary();

            panel.innerHTML = `
                <div class="social-panel-header">
                    <h3>🌟 社交分享</h3>
                    <button onclick="toggleSocialPanel()" class="close-btn">✕</button>
                </div>
                
                <div class="social-tabs">
                    <button class="social-tab active" onclick="showSocialTab('share')">分享</button>
                    <button class="social-tab" onclick="showSocialTab('leaderboard')">排行榜</button>
                    <button class="social-tab" onclick="showSocialTab('challenges')">挑战</button>
                </div>
                
                <div class="social-content">
                    <div id="shareTab" class="social-tab-content active">
                        <div class="share-section">
                            <h4>📸 办公室截图</h4>
                            <p>分享你的办公室布局和成就</p>
                            <button class="btn btn-primary" onclick="captureAndShare()">📸 截图分享</button>
                        </div>
                        
                        <div class="share-section">
                            <h4>🏆 成就分享</h4>
                            <p>展示你的最新成就</p>
                            <div id="achievementShareList"></div>
                        </div>
                        
                        <div class="share-section">
                            <h4>📊 统计分享</h4>
                            <p>分享你的游戏统计数据</p>
                            <button class="btn btn-secondary" onclick="shareGameStats()">📊 分享统计</button>
                        </div>
                        
                        <div class="share-section">
                            <h4>📜 分享历史</h4>
                            <div id="shareHistory"></div>
                        </div>
                    </div>
                    
                    <div id="leaderboardTab" class="social-tab-content">
                        <div id="leaderboardContent"></div>
                    </div>
                    
                    <div id="challengesTab" class="social-tab-content">
                        <div id="challengesContent"></div>
                    </div>
                </div>
            `;

            document.body.appendChild(panel);

            // 初始化内容
            updateSocialPanel();
        }

        // 切换社交面板标签
        function showSocialTab(tabName) {
            // 更新标签状态
            document.querySelectorAll('.social-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.social-tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // 激活选中的标签
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');

            // 更新内容
            updateSocialTabContent(tabName);
        }

        // 更新社交面板内容
        function updateSocialPanel() {
            updateSocialTabContent('share');
        }

        // 更新社交标签内容
        function updateSocialTabContent(tabName) {
            const leaderboardSystem = window.game.gameManager.getLeaderboardSystem();

            switch (tabName) {
                case 'share':
                    updateShareTab(leaderboardSystem);
                    break;
                case 'leaderboard':
                    updateLeaderboardTab(leaderboardSystem);
                    break;
                case 'challenges':
                    updateChallengesTab(leaderboardSystem);
                    break;
            }
        }

        // 更新分享标签
        function updateShareTab(leaderboardSystem) {
            // 更新成就分享列表
            const achievementSystem = window.game.gameManager.getAchievementSystem();
            const recentAchievements = achievementSystem.getUnlockedAchievements().slice(-5);

            const achievementList = document.getElementById('achievementShareList');
            if (achievementList) {
                achievementList.innerHTML = recentAchievements.map(achievement => `
                    <div class="achievement-share-item">
                        <span class="achievement-icon">${achievement.icon}</span>
                        <div class="achievement-info">
                            <strong>${achievement.name}</strong>
                            <p>${achievement.description}</p>
                        </div>
                        <button class="btn btn-sm btn-primary" onclick="shareAchievement('${achievement.id}')">分享</button>
                    </div>
                `).join('');
            }

            // 更新分享历史
            const shareHistory = document.getElementById('shareHistory');
            if (shareHistory) {
                const history = leaderboardSystem.shareHistory.slice(-5);
                shareHistory.innerHTML = history.length > 0 ? history.map(share => `
                    <div class="share-history-item">
                        <span class="share-type">${share.type === 'achievement' ? '🏆' : '📊'}</span>
                        <div class="share-info">
                            <strong>${share.type === 'achievement' ? share.achievement.name : '游戏统计'}</strong>
                            <small>${new Date(share.timestamp).toLocaleString()}</small>
                        </div>
                        <button class="btn btn-sm btn-secondary" onclick="reshareContent('${share.timestamp}')">重新分享</button>
                    </div>
                `).join('') : '<p class="no-data">暂无分享记录</p>';
            }
        }

        // 更新排行榜标签
        function updateLeaderboardTab(leaderboardSystem) {
            const leaderboards = leaderboardSystem.getAllLeaderboards();
            const content = document.getElementById('leaderboardContent');

            if (content) {
                content.innerHTML = `
                    <div class="leaderboard-selector">
                        <select id="leaderboardSelect" onchange="updateSelectedLeaderboard()">
                            ${leaderboards.map(lb => `
                                <option value="${lb.id}">${lb.icon} ${lb.name}</option>
                            `).join('')}
                        </select>
                    </div>
                    <div id="selectedLeaderboard"></div>
                `;

                // 显示第一个排行榜
                if (leaderboards.length > 0) {
                    updateSelectedLeaderboard();
                }
            }
        }

        // 更新选中的排行榜
        function updateSelectedLeaderboard() {
            const select = document.getElementById('leaderboardSelect');
            const leaderboardSystem = window.game.gameManager.getLeaderboardSystem();

            if (select && leaderboardSystem) {
                const leaderboard = leaderboardSystem.getLeaderboard(select.value, 10);
                const container = document.getElementById('selectedLeaderboard');

                if (container && leaderboard) {
                    container.innerHTML = `
                        <div class="leaderboard-header">
                            <h4>${leaderboard.icon} ${leaderboard.name}</h4>
                            <p>${leaderboard.description}</p>
                        </div>
                        <div class="leaderboard-entries">
                            ${leaderboard.entries.length > 0 ? leaderboard.entries.map((entry, index) => `
                                <div class="leaderboard-entry ${index < 3 ? 'top-rank' : ''}">
                                    <span class="rank">#${index + 1}</span>
                                    <span class="player-name">${entry.playerName}</span>
                                    <span class="score">${entry.score.toLocaleString()}</span>
                                    <span class="date">${new Date(entry.timestamp).toLocaleDateString()}</span>
                                </div>
                            `).join('') : '<p class="no-data">暂无排行榜数据</p>'}
                        </div>
                        <div class="leaderboard-actions">
                            <button class="btn btn-primary" onclick="recordCurrentScore('${select.value}')">记录当前成绩</button>
                            <button class="btn btn-secondary" onclick="shareLeaderboard('${select.value}')">分享排行榜</button>
                        </div>
                    `;
                }
            }
        }

        // 更新挑战标签
        function updateChallengesTab(leaderboardSystem) {
            const activeChallenges = leaderboardSystem.getActiveChallenges();
            const specialEvents = leaderboardSystem.getActiveSpecialEvents();
            const content = document.getElementById('challengesContent');

            if (content) {
                content.innerHTML = `
                    <div class="challenges-section">
                        <h4>🎯 活跃挑战</h4>
                        <div class="challenges-list">
                            ${activeChallenges.length > 0 ? activeChallenges.map(challenge => `
                                <div class="challenge-item ${challenge.completed ? 'completed' : ''}">
                                    <div class="challenge-header">
                                        <span class="challenge-icon">${challenge.icon}</span>
                                        <div class="challenge-info">
                                            <strong>${challenge.name}</strong>
                                            <p>${challenge.description}</p>
                                        </div>
                                        <span class="challenge-type">${challenge.type}</span>
                                    </div>
                                    <div class="challenge-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: ${challenge.progressPercentage}%"></div>
                                        </div>
                                        <span class="progress-text">${challenge.progress}/${challenge.target}</span>
                                    </div>
                                    <div class="challenge-actions">
                                        ${challenge.completed && !challenge.claimed ?
                        `<button class="btn btn-success" onclick="claimChallengeReward('${challenge.id}')">领取奖励</button>` :
                        `<span class="time-remaining">${formatTimeRemaining(challenge.timeRemaining)}</span>`
                    }
                                        <button class="btn btn-sm btn-secondary" onclick="shareChallenge('${challenge.id}')">分享</button>
                                    </div>
                                </div>
                            `).join('') : '<p class="no-data">暂无活跃挑战</p>'}
                        </div>
                    </div>
                    
                    <div class="special-events-section">
                        <h4>🎪 特殊事件</h4>
                        <div class="events-list">
                            ${specialEvents.length > 0 ? specialEvents.map(event => `
                                <div class="event-item ${event.completed ? 'completed' : ''} ${event.difficulty}">
                                    <div class="event-header">
                                        <span class="event-icon">${event.icon}</span>
                                        <div class="event-info">
                                            <strong>${event.name}</strong>
                                            <p>${event.description}</p>
                                            <span class="event-difficulty">${event.difficulty.toUpperCase()}</span>
                                        </div>
                                    </div>
                                    <div class="event-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: ${event.progressPercentage}%"></div>
                                        </div>
                                        <span class="progress-text">${event.progress}/${event.target}</span>
                                    </div>
                                    <div class="event-actions">
                                        ${event.completed && !event.claimed ?
                            `<button class="btn btn-success" onclick="claimChallengeReward('${event.id}')">领取奖励</button>` :
                            `<span class="time-remaining">${formatTimeRemaining(event.timeRemaining)}</span>`
                        }
                                        <button class="btn btn-sm btn-secondary" onclick="shareSpecialEvent('${event.id}')">分享</button>
                                    </div>
                                </div>
                            `).join('') : '<p class="no-data">暂无特殊事件</p>'}
                        </div>
                    </div>
                `;
            }
        }

        // 截图并分享
        function captureAndShare() {
            const leaderboardSystem = window.game.gameManager.getLeaderboardSystem();
            const screenshot = leaderboardSystem.captureOfficeScreenshot();

            if (screenshot) {
                const shareData = leaderboardSystem.shareOfficeStatus();
                showSharePreview(shareData);
            } else {
                alert('截图失败，请重试');
            }
        }

        // 分享成就
        function shareAchievement(achievementId) {
            const leaderboardSystem = window.game.gameManager.getLeaderboardSystem();
            const shareData = leaderboardSystem.shareAchievement(achievementId);

            if (shareData) {
                showSharePreview(shareData);
            } else {
                alert('分享失败，请重试');
            }
        }

        // 分享游戏统计
        function shareGameStats() {
            const leaderboardSystem = window.game.gameManager.getLeaderboardSystem();
            const shareData = {
                type: 'game_stats',
                stats: {
                    totalScore: leaderboardSystem.calculateTotalScore(),
                    employeeCount: window.game.employees.length,
                    resources: window.game.gameManager.getResourceSystem().getResourceSummary(),
                    achievements: window.game.gameManager.getAchievementSystem().unlockedAchievements.size,
                    gameTime: window.game.gameTime
                },
                timestamp: Date.now()
            };

            leaderboardSystem.shareHistory.push(shareData);
            showSharePreview(shareData);
        }

        // 记录当前成绩
        function recordCurrentScore(leaderboardId) {
            const leaderboardSystem = window.game.gameManager.getLeaderboardSystem();
            const success = leaderboardSystem.recordScore(leaderboardId, '当前玩家');

            if (success) {
                alert('成绩已记录到排行榜！');
                updateSelectedLeaderboard();
            } else {
                alert('记录成绩失败，请重试');
            }
        }

        // 分享排行榜
        function shareLeaderboard(leaderboardId) {
            const leaderboardSystem = window.game.gameManager.getLeaderboardSystem();
            const leaderboard = leaderboardSystem.getLeaderboard(leaderboardId, 5);

            if (leaderboard) {
                const shareData = {
                    type: 'leaderboard',
                    leaderboard: {
                        name: leaderboard.name,
                        icon: leaderboard.icon,
                        topEntries: leaderboard.entries.slice(0, 5)
                    },
                    playerRank: leaderboardSystem.getPlayerRank(leaderboardId),
                    timestamp: Date.now()
                };

                leaderboardSystem.shareHistory.push(shareData);
                showSharePreview(shareData);
            }
        }

        // 分享挑战
        function shareChallenge(challengeId) {
            const leaderboardSystem = window.game.gameManager.getLeaderboardSystem();
            const challenge = leaderboardSystem.challenges.get(challengeId);

            if (challenge) {
                const shareData = {
                    type: 'challenge',
                    challenge: {
                        name: challenge.name,
                        description: challenge.description,
                        icon: challenge.icon,
                        progress: challenge.progress,
                        target: challenge.target,
                        completed: challenge.completed
                    },
                    timestamp: Date.now()
                };

                leaderboardSystem.shareHistory.push(shareData);
                showSharePreview(shareData);
            }
        }

        // 分享特殊事件
        function shareSpecialEvent(eventId) {
            shareChallenge(eventId); // 使用相同的逻辑
        }

        // 领取挑战奖励
        function claimChallengeReward(challengeId) {
            const leaderboardSystem = window.game.gameManager.getLeaderboardSystem();
            const success = leaderboardSystem.claimChallengeReward(challengeId);

            if (success) {
                alert('奖励已领取！');
                updateSocialTabContent('challenges');
            } else {
                alert('领取奖励失败');
            }
        }

        // 显示分享预览
        function showSharePreview(shareData) {
            const modal = document.createElement('div');
            modal.className = 'share-preview-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 3000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;

            const content = document.createElement('div');
            content.className = 'share-preview-content';
            content.style.cssText = `
                background: white;
                padding: 20px;
                border-radius: 15px;
                max-width: 500px;
                max-height: 80vh;
                overflow-y: auto;
                position: relative;
            `;

            let previewHTML = `
                <div class="share-preview-header">
                    <h3>📤 分享预览</h3>
                    <button onclick="document.body.removeChild(this.closest('.share-preview-modal'))" class="close-btn">✕</button>
                </div>
            `;

            switch (shareData.type) {
                case 'office_status':
                    previewHTML += `
                        <div class="share-preview-body">
                            <img src="${shareData.screenshot}" alt="办公室截图" style="width: 100%; border-radius: 8px; margin-bottom: 15px;">
                            <h4>我的办公室状态</h4>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <strong>总分:</strong> ${shareData.stats.totalScore.toLocaleString()}
                                </div>
                                <div class="stat-item">
                                    <strong>员工数:</strong> ${shareData.stats.employeeCount}
                                </div>
                                <div class="stat-item">
                                    <strong>资金:</strong> ${shareData.stats.resources.money.toLocaleString()}元
                                </div>
                                <div class="stat-item">
                                    <strong>成就数:</strong> ${shareData.stats.achievements}
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'achievement':
                    previewHTML += `
                        <div class="share-preview-body">
                            <div class="achievement-share-preview">
                                <span class="achievement-icon-large">${shareData.achievement.icon}</span>
                                <h4>🎉 成就解锁！</h4>
                                <h3>${shareData.achievement.name}</h3>
                                <p>${shareData.achievement.description}</p>
                                <div class="player-stats">
                                    <small>总分: ${shareData.playerStats.totalScore.toLocaleString()} | 员工: ${shareData.playerStats.employeeCount}人</small>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'game_stats':
                    previewHTML += `
                        <div class="share-preview-body">
                            <h4>📊 我的游戏统计</h4>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <strong>总分:</strong> ${shareData.stats.totalScore.toLocaleString()}
                                </div>
                                <div class="stat-item">
                                    <strong>员工数:</strong> ${shareData.stats.employeeCount}
                                </div>
                                <div class="stat-item">
                                    <strong>资金:</strong> ${shareData.stats.resources.money.toLocaleString()}元
                                </div>
                                <div class="stat-item">
                                    <strong>满意度:</strong> ${shareData.stats.resources.satisfaction}%
                                </div>
                                <div class="stat-item">
                                    <strong>生产力:</strong> ${shareData.stats.resources.productivity}%
                                </div>
                                <div class="stat-item">
                                    <strong>声望:</strong> ${shareData.stats.resources.reputation}
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }

            previewHTML += `
                <div class="share-preview-actions">
                    <button class="btn btn-primary" onclick="copyShareData('${btoa(JSON.stringify(shareData))}')">📋 复制分享数据</button>
                    <button class="btn btn-secondary" onclick="downloadShareImage('${shareData.type}', '${btoa(JSON.stringify(shareData))}')">💾 下载图片</button>
                    <button class="btn btn-success" onclick="exportShareData('${btoa(JSON.stringify(shareData))}')">📤 导出数据</button>
                </div>
            `;

            content.innerHTML = previewHTML;
            modal.appendChild(content);
            document.body.appendChild(modal);

            // 点击背景关闭
            modal.onclick = (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            };
        }

        // 复制分享数据
        function copyShareData(encodedData) {
            const shareData = JSON.parse(atob(encodedData));
            const shareText = generateShareText(shareData);

            navigator.clipboard.writeText(shareText).then(() => {
                alert('分享数据已复制到剪贴板！');
            }).catch(() => {
                // 降级方案
                const textArea = document.createElement('textarea');
                textArea.value = shareText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('分享数据已复制到剪贴板！');
            });
        }

        // 生成分享文本
        function generateShareText(shareData) {
            switch (shareData.type) {
                case 'office_status':
                    return `🏢 我的办公室状态
📊 总分: ${shareData.stats.totalScore.toLocaleString()}
👥 员工数: ${shareData.stats.employeeCount}
💰 资金: ${shareData.stats.resources.money.toLocaleString()}元
😊 满意度: ${shareData.stats.resources.satisfaction}%
⚡ 生产力: ${shareData.stats.resources.productivity}%
⭐ 声望: ${shareData.stats.resources.reputation}

#办公室生存游戏 #管理模拟`;

                case 'achievement':
                    return `🎉 成就解锁！
${shareData.achievement.icon} ${shareData.achievement.name}
${shareData.achievement.description}

📊 当前总分: ${shareData.playerStats.totalScore.toLocaleString()}
👥 员工数: ${shareData.playerStats.employeeCount}人

#办公室生存游戏 #成就解锁`;

                case 'game_stats':
                    return `📊 我的游戏统计
📈 总分: ${shareData.stats.totalScore.toLocaleString()}
👥 员工: ${shareData.stats.employeeCount}人
💰 资金: ${shareData.stats.resources.money.toLocaleString()}元
😊 满意度: ${shareData.stats.resources.satisfaction}%
⚡ 生产力: ${shareData.stats.resources.productivity}%
⭐ 声望: ${shareData.stats.resources.reputation}

#办公室生存游戏 #游戏统计`;

                default:
                    return '办公室生存游戏分享 #办公室生存游戏';
            }
        }

        // 下载分享图片
        function downloadShareImage(type, encodedData) {
            // 简化实现：创建一个包含分享信息的canvas
            const shareData = JSON.parse(atob(encodedData));
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            canvas.width = 600;
            canvas.height = 400;

            // 背景
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 标题
            ctx.fillStyle = '#333';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('办公室生存游戏', canvas.width / 2, 50);

            // 内容
            ctx.font = '16px Arial';
            ctx.textAlign = 'left';
            const shareText = generateShareText(shareData);
            const lines = shareText.split('\n');

            lines.forEach((line, index) => {
                ctx.fillText(line, 50, 100 + index * 25);
            });

            // 下载
            const link = document.createElement('a');
            link.download = `office-game-share-${type}-${Date.now()}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        // 导出分享数据
        function exportShareData(encodedData) {
            const shareData = JSON.parse(atob(encodedData));
            const dataStr = JSON.stringify(shareData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });

            const link = document.createElement('a');
            link.download = `office-game-share-${shareData.type}-${Date.now()}.json`;
            link.href = URL.createObjectURL(dataBlob);
            link.click();
        }

        // 格式化剩余时间
        function formatTimeRemaining(milliseconds) {
            const seconds = Math.floor(milliseconds / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);

            if (days > 0) return `${days}天${hours % 24}小时`;
            if (hours > 0) return `${hours}小时${minutes % 60}分钟`;
            if (minutes > 0) return `${minutes}分钟`;
            return `${seconds}秒`;
        }

        // 重新分享内容
        function reshareContent(timestamp) {
            const leaderboardSystem = window.game.gameManager.getLeaderboardSystem();
            const shareItem = leaderboardSystem.shareHistory.find(item => item.timestamp == timestamp);

            if (shareItem) {
                showSharePreview(shareItem);
            }
        }

        // 全局社交分享函数
        window.toggleSocialPanel = toggleSocialPanel;
        window.showSocialTab = showSocialTab;
        window.updateSocialPanel = updateSocialPanel;
        window.captureAndShare = captureAndShare;
        window.shareAchievement = shareAchievement;
        window.shareGameStats = shareGameStats;
        window.recordCurrentScore = recordCurrentScore;
        window.shareLeaderboard = shareLeaderboard;
        window.shareChallenge = shareChallenge;
        window.shareSpecialEvent = shareSpecialEvent;
        window.claimChallengeReward = claimChallengeReward;
        window.updateSelectedLeaderboard = updateSelectedLeaderboard;
        window.copyShareData = copyShareData;
        window.downloadShareImage = downloadShareImage;
        window.exportShareData = exportShareData;
        window.reshareContent = reshareContent;
    </script>
</body>

</html>